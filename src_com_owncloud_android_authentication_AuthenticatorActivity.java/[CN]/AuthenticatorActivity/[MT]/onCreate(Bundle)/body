{
  super.onCreate(savedInstanceState);
  getWindow().requestFeature(Window.FEATURE_NO_TITLE);
  setContentView(R.layout.account_setup);
  mRefreshButton=(ImageView)findViewById(R.id.refreshButton);
  mViewPasswordButton=(ImageView)findViewById(R.id.viewPasswordButton);
  mHostUrlInput=(EditText)findViewById(R.id.hostUrlInput);
  mUsernameInput=(EditText)findViewById(R.id.account_username);
  mPasswordInput=(EditText)findViewById(R.id.account_password);
  mOAuthAuthEndpointText=(TextView)findViewById(R.id.oAuthEntryPoint_1);
  mOAuthTokenEndpointText=(TextView)findViewById(R.id.oAuthEntryPoint_2);
  mOAuth2Check=(CheckBox)findViewById(R.id.oauth_onOff_check);
  mOkButton=findViewById(R.id.buttonOK);
  mAuthStatusLayout=(TextView)findViewById(R.id.auth_status_text);
  Button b=(Button)findViewById(R.id.account_register);
  if (b != null) {
    b.setText(String.format(getString(R.string.auth_register),getString(R.string.app_name)));
  }
  mHostUrlInput.setOnFocusChangeListener(this);
  mPasswordInput.setOnFocusChangeListener(this);
  mPasswordInput.setImeOptions(EditorInfo.IME_ACTION_DONE);
  mPasswordInput.setOnEditorActionListener(this);
  mAccountMgr=AccountManager.get(this);
  mNewCapturedUriFromOAuth2Redirection=null;
  mAction=getIntent().getByteExtra(EXTRA_ACTION,ACTION_CREATE);
  mAccount=null;
  if (savedInstanceState == null) {
    mStatusText=mStatusIcon=0;
    mStatusCorrect=false;
    mIsSslConn=false;
    updateConnStatus();
    updateAuthStatus();
    String tokenType=getIntent().getExtras().getString(AccountAuthenticator.KEY_AUTH_TOKEN_TYPE);
    boolean oAuthRequired=AccountAuthenticator.AUTH_TOKEN_TYPE_ACCESS_TOKEN.equals(tokenType) || OAUTH_MODE_ON.equals(getString(R.string.oauth2_mode));
    mAccount=getIntent().getExtras().getParcelable(EXTRA_ACCOUNT);
    if (mAccount != null) {
      String ocVersion=mAccountMgr.getUserData(mAccount,AccountAuthenticator.KEY_OC_VERSION);
      if (ocVersion != null) {
        mDiscoveredVersion=new OwnCloudVersion(ocVersion);
      }
      mHostBaseUrl=mAccountMgr.getUserData(mAccount,AccountAuthenticator.KEY_OC_BASE_URL);
      mHostUrlInput.setText(mHostBaseUrl);
      String userName=mAccount.name.substring(0,mAccount.name.lastIndexOf('@'));
      mUsernameInput.setText(userName);
      oAuthRequired=(mAccountMgr.getUserData(mAccount,AccountAuthenticator.KEY_SUPPORTS_OAUTH2) != null);
    }
    mOAuth2Check.setChecked(oAuthRequired);
    changeViewByOAuth2Check(oAuthRequired);
  }
 else {
    loadSavedInstanceState(savedInstanceState);
  }
  if (!OAUTH_MODE_OPTIONAL.equals(getString(R.string.oauth2_mode))) {
    mOAuth2Check.setVisibility(View.GONE);
  }
  if (mAction == ACTION_UPDATE_TOKEN) {
    mHostUrlInput.setEnabled(false);
    mUsernameInput.setEnabled(false);
    mOAuth2Check.setVisibility(View.GONE);
    checkOcServer();
  }
  mPasswordInput.setText("");
  mJustCreated=true;
}
