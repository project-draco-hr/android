{
  if (!instantPictureUploadEnabled(context)) {
    Log_OC.d(TAG,"Instant upload disabled, don't upload anything");
    return;
  }
  if (!intent.hasExtra(ConnectivityManager.EXTRA_NO_CONNECTIVITY) && isOnline(context) && (!instantPictureUploadViaWiFiOnly(context) || (instantPictureUploadViaWiFiOnly(context) == isConnectedViaWiFi(context) == true))) {
    DbHandler db=new DbHandler(context);
    Cursor c=db.getAwaitingFiles();
    if (c.moveToFirst()) {
      do {
        String account_name=c.getString(c.getColumnIndex("account"));
        String file_path=c.getString(c.getColumnIndex("path"));
        File f=new File(file_path);
        if (f.exists()) {
          Account account=new Account(account_name,MainApp.getAccountType());
          String mimeType=null;
          try {
            mimeType=MimeTypeMap.getSingleton().getMimeTypeFromExtension(f.getName().substring(f.getName().lastIndexOf('.') + 1));
          }
 catch (          Throwable e) {
            Log_OC.e(TAG,"Trying to find out MIME type of a file without extension: " + f.getName());
          }
          if (mimeType == null)           mimeType="application/octet-stream";
          Intent i=new Intent(context,FileUploader.class);
          i.putExtra(FileUploader.KEY_ACCOUNT,account);
          i.putExtra(FileUploader.KEY_LOCAL_FILE,file_path);
          i.putExtra(FileUploader.KEY_REMOTE_FILE,FileStorageUtils.getInstantUploadFilePath(context,f.getName()));
          i.putExtra(FileUploader.KEY_UPLOAD_TYPE,FileUploader.UPLOAD_SINGLE_FILE);
          i.putExtra(FileUploader.KEY_INSTANT_UPLOAD,true);
          SharedPreferences appPreferences=PreferenceManager.getDefaultSharedPreferences(context);
          String behaviour=appPreferences.getString("prefs_instant_behaviour","NOTHING");
          if (behaviour.equalsIgnoreCase("NOTHING")) {
            Log_OC.d(TAG,"upload file and do nothing");
            i.putExtra(FileUploader.KEY_LOCAL_BEHAVIOUR,FileUploader.LOCAL_BEHAVIOUR_FORGET);
          }
 else           if (behaviour.equalsIgnoreCase("COPY")) {
            i.putExtra(FileUploader.KEY_LOCAL_BEHAVIOUR,FileUploader.LOCAL_BEHAVIOUR_COPY);
            Log_OC.d(TAG,"upload file and copy file to oc folder");
          }
 else           if (behaviour.equalsIgnoreCase("MOVE")) {
            i.putExtra(FileUploader.KEY_LOCAL_BEHAVIOUR,FileUploader.LOCAL_BEHAVIOUR_MOVE);
            Log_OC.d(TAG,"upload file and move file to oc folder");
          }
 else           if (behaviour.equalsIgnoreCase("DELETE")) {
            i.putExtra(FileUploader.KEY_LOCAL_BEHAVIOUR,FileUploader.LOCAL_BEHAVIOUR_REMOVE);
            Log_OC.d(TAG,"upload file and delete file in original place");
          }
          context.startService(i);
        }
 else {
          Log_OC.w(TAG,"Instant upload file " + f.getAbsolutePath() + " dont exist anymore");
        }
      }
 while (c.moveToNext());
    }
    c.close();
    db.close();
  }
}
