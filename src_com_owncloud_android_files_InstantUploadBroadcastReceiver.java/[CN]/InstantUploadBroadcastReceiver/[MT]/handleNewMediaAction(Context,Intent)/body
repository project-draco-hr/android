{
  Cursor c=null;
  String file_path=null;
  String file_name=null;
  String mime_type=null;
  if (!instantUploadEnabled(context)) {
    Log_OC.d(TAG,"Instant upload disabled, aborting uploading");
    return;
  }
  Account account=AccountUtils.getCurrentOwnCloudAccount(context);
  if (account == null) {
    Log_OC.w(TAG,"No owncloud account found for instant upload, aborting");
    return;
  }
  if (intent.getAction().equals(NEW_PHOTO_ACTION)) {
    String[] CONTENT_PROJECTION={Images.Media.DATA,Images.Media.DISPLAY_NAME,Images.Media.MIME_TYPE,Images.Media.SIZE};
    c=context.getContentResolver().query(intent.getData(),CONTENT_PROJECTION,null,null,null);
    if (!c.moveToFirst()) {
      Log_OC.e(TAG,"Couldn't resolve given uri: " + intent.getDataString());
      return;
    }
    file_path=c.getString(c.getColumnIndex(Images.Media.DATA));
    file_name=c.getString(c.getColumnIndex(Images.Media.DISPLAY_NAME));
    mime_type=c.getString(c.getColumnIndex(Images.Media.MIME_TYPE));
    Log_OC.w(TAG,"New photo received");
  }
 else   if (intent.getAction().equals(NEW_VIDEO_ACTION)) {
    if (!isConnectedViaWiFi(context)) {
      Log_OC.e(TAG,"No Wifi available .. Video instant upload only possible if WiFi is on");
      return;
    }
    String[] CONTENT_PROJECTION={Video.Media.DATA,Video.Media.DISPLAY_NAME,Video.Media.MIME_TYPE,Video.Media.SIZE};
    c=context.getContentResolver().query(intent.getData(),CONTENT_PROJECTION,null,null,null);
    if (!c.moveToFirst()) {
      Log_OC.e(TAG,"Couldn't resolve given uri: " + intent.getDataString());
      return;
    }
    file_path=c.getString(c.getColumnIndex(Video.Media.DATA));
    file_name=c.getString(c.getColumnIndex(Video.Media.DISPLAY_NAME));
    mime_type=c.getString(c.getColumnIndex(Video.Media.MIME_TYPE));
    Log_OC.w(TAG,"New video received");
  }
  c.close();
  Log_OC.d(TAG,file_path + "");
  DbHandler db=new DbHandler(context);
  db.putFileForLater(file_path,account.name,null);
  db.close();
  if (!isOnline(context) || (instantUploadViaWiFiOnly(context) && !isConnectedViaWiFi(context))) {
    return;
  }
  Intent i=new Intent(context,FileUploader.class);
  i.putExtra(FileUploader.KEY_ACCOUNT,account);
  i.putExtra(FileUploader.KEY_LOCAL_FILE,file_path);
  i.putExtra(FileUploader.KEY_REMOTE_FILE,FileStorageUtils.getInstantUploadFilePath(context,file_name));
  i.putExtra(FileUploader.KEY_UPLOAD_TYPE,FileUploader.UPLOAD_SINGLE_FILE);
  i.putExtra(FileUploader.KEY_MIME_TYPE,mime_type);
  i.putExtra(FileUploader.KEY_INSTANT_UPLOAD,true);
  context.startService(i);
}
