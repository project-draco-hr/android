{
  Cursor c=null;
  String file_path=null;
  String file_name=null;
  String mime_type=null;
  Log_OC.i(TAG,"New photo received");
  if (!PreferenceReader.instantPictureUploadEnabled(context)) {
    Log_OC.d(TAG,"Instant picture upload disabled, ignoring new picture");
    return;
  }
  Account account=AccountUtils.getCurrentOwnCloudAccount(context);
  if (account == null) {
    Log_OC.w(TAG,"No account found for instant upload, aborting");
    return;
  }
  String[] CONTENT_PROJECTION={Images.Media.DATA,Images.Media.DISPLAY_NAME,Images.Media.MIME_TYPE,Images.Media.SIZE};
  int permissionCheck=ContextCompat.checkSelfPermission(context,Manifest.permission.READ_EXTERNAL_STORAGE);
  if (android.content.pm.PackageManager.PERMISSION_GRANTED != permissionCheck) {
    Log_OC.w(TAG,"Read external storage permission isn't granted, aborting");
    return;
  }
  c=context.getContentResolver().query(intent.getData(),CONTENT_PROJECTION,null,null,null);
  if (!c.moveToFirst()) {
    Log_OC.e(TAG,"Couldn't resolve given uri: " + intent.getDataString());
    return;
  }
  file_path=c.getString(c.getColumnIndex(Images.Media.DATA));
  file_name=c.getString(c.getColumnIndex(Images.Media.DISPLAY_NAME));
  mime_type=c.getString(c.getColumnIndex(Images.Media.MIME_TYPE));
  c.close();
  if (file_path.equals(lastUploadedPhotoPath)) {
    Log_OC.d(TAG,"Duplicate detected: " + file_path + ". Ignore.");
    return;
  }
  lastUploadedPhotoPath=file_path;
  Log_OC.d(TAG,"Path: " + file_path + "");
  new FileUploader.UploadRequester();
  int behaviour=getUploadBehaviour(context);
  FileUploader.UploadRequester requester=new FileUploader.UploadRequester();
  requester.uploadNewFile(context,account,file_path,FileStorageUtils.getInstantUploadFilePath(context,file_name),behaviour,mime_type,true,UploadFileOperation.CREATED_AS_INSTANT_PICTURE);
}
