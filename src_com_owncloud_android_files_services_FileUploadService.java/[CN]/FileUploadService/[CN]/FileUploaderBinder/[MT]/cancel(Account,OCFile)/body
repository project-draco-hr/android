{
  if (mCurrentUpload != null && mCurrentUpload.isUploadInProgress()) {
    mCurrentUpload.cancel();
  }
 else   if (mCancellationPossible.get()) {
    mCancellationRequested.set(true);
  }
 else {
    UploadDbObject upload=mPendingUploads.remove(buildRemoteName(account,file));
    upload.setUploadStatus(UploadStatus.UPLOAD_CANCELLED);
    upload.setLastResult(new RemoteOperationResult(ResultCode.CANCELLED));
    upload.getOCFile().setStoragePath(file.getStoragePath());
    mDb.updateUploadStatus(upload);
  }
}
