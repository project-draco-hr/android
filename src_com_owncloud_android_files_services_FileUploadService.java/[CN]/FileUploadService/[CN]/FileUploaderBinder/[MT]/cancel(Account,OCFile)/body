{
  if (mCurrentUpload != null && mCurrentUpload.isUploadInProgress()) {
    Log_OC.d(TAG,"Calling cancel for " + file.getRemotePath() + " during upload operation.");
    mCurrentUpload.cancel();
  }
 else   if (mCancellationPossible.get()) {
    Log_OC.d(TAG,"Calling cancel for " + file.getRemotePath() + " during preparing for upload.");
    mCancellationRequested.set(true);
  }
 else {
    Log_OC.d(TAG,"Calling cancel for " + file.getRemotePath() + " while upload is pending.");
    UploadDbObject upload=mPendingUploads.remove(buildRemoteName(account,file));
    upload.setUploadStatus(UploadStatus.UPLOAD_CANCELLED);
    upload.setLastResult(new RemoteOperationResult(ResultCode.CANCELLED));
    upload.getOCFile().setStoragePath(file.getStoragePath());
    mDb.updateUploadStatus(upload);
  }
}
