{
  if (uploadDbObject.getUploadStatus() == UploadStatus.UPLOAD_SUCCEEDED) {
    Log_OC.w(TAG,"Already succeeded uploadObject was again scheduled for upload. Fix that!");
    return;
  }
  UploadFileOperation currentUpload=null;
synchronized (mActiveUploads) {
    currentUpload=mActiveUploads.get(uploadDbObject.getRemotePath());
    if (currentUpload == null) {
      if (uploadDbObject.isUseWifiOnly() && !InstantUploadBroadcastReceiver.isConnectedViaWiFi(getApplicationContext())) {
        Log_OC.d(TAG,"Do not start upload because it is wifi-only.");
        return;
      }
      AccountManager aMgr=AccountManager.get(this);
      Account account=uploadDbObject.getAccount(getApplicationContext());
      String version=aMgr.getUserData(account,Constants.KEY_OC_VERSION);
      OwnCloudVersion ocv=new OwnCloudVersion(version);
      boolean chunked=FileUploadService.chunkedUploadIsSupported(ocv);
      String uploadKey=null;
      uploadKey=buildRemoteName(account,uploadDbObject.getRemotePath());
      OCFile file=obtainNewOCFileToUpload(uploadDbObject.getRemotePath(),uploadDbObject.getLocalPath(),uploadDbObject.getMimeType());
      currentUpload=new UploadFileOperation(account,file,chunked,uploadDbObject.isForceOverwrite(),uploadDbObject.getLocalAction(),getApplicationContext());
      if (uploadDbObject.isCreateRemoteFolder()) {
        currentUpload.setRemoteFolderToBeCreated();
      }
      mActiveUploads.putIfAbsent(uploadKey,currentUpload);
      currentUpload.addDatatransferProgressListener((FileUploaderBinder)mBinder);
    }
  }
  if (currentUpload != null) {
    notifyUploadStart(currentUpload);
    RemoteOperationResult uploadResult=null, grantResult=null;
    try {
      if (mUploadClient == null || !mLastAccount.equals(currentUpload.getAccount())) {
        mLastAccount=currentUpload.getAccount();
        mStorageManager=new FileDataStorageManager(mLastAccount,getContentResolver());
        OwnCloudAccount ocAccount=new OwnCloudAccount(mLastAccount,this);
        mUploadClient=OwnCloudClientManagerFactory.getDefaultSingleton().getClientFor(ocAccount,this);
      }
      String remoteParentPath=new File(currentUpload.getRemotePath()).getParent();
      remoteParentPath=remoteParentPath.endsWith(OCFile.PATH_SEPARATOR) ? remoteParentPath : remoteParentPath + OCFile.PATH_SEPARATOR;
      grantResult=grantFolderExistence(currentUpload,remoteParentPath);
      if (grantResult.isSuccess()) {
        OCFile parent=mStorageManager.getFileByPath(remoteParentPath);
        currentUpload.getFile().setParentId(parent.getFileId());
        uploadResult=currentUpload.execute(mUploadClient);
        if (uploadResult.isSuccess()) {
          saveUploadedFile(currentUpload);
        }
      }
 else {
        uploadResult=grantResult;
      }
    }
 catch (    AccountsException e) {
      Log_OC.e(TAG,"Error while trying to get autorization for " + mLastAccount.name,e);
      uploadResult=new RemoteOperationResult(e);
    }
catch (    IOException e) {
      Log_OC.e(TAG,"Error while trying to get autorization for " + mLastAccount.name,e);
      uploadResult=new RemoteOperationResult(e);
    }
 finally {
synchronized (mActiveUploads) {
        mActiveUploads.remove(uploadDbObject);
        Log_OC.i(TAG,"Remove CurrentUploadItem from pending upload Item Map.");
      }
      if (uploadResult.isException()) {
        mUploadClient=null;
      }
    }
    notifyUploadResult(uploadResult,currentUpload);
    sendFinalBroadcast(currentUpload,uploadResult);
  }
}
