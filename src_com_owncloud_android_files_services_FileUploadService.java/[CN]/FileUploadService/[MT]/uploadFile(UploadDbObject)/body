{
  if (mCurrentUpload != null) {
    Log_OC.e(TAG,"mCurrentUpload != null. Meaning there is another upload in progress, cannot start a new one. Fix that!");
    return new RemoteOperationResult(new IllegalStateException("mCurrentUpload != null when calling uploadFile()"));
  }
  AccountManager aMgr=AccountManager.get(this);
  Account account=uploadDbObject.getAccount(getApplicationContext());
  String version=aMgr.getUserData(account,Constants.KEY_OC_VERSION);
  OwnCloudVersion ocv=new OwnCloudVersion(version);
  boolean chunked=FileUploadService.chunkedUploadIsSupported(ocv);
  String uploadKey=null;
  uploadKey=buildRemoteName(account,uploadDbObject.getRemotePath());
  OCFile file=uploadDbObject.getOCFile();
  mCurrentUpload=new UploadFileOperation(account,file,chunked,uploadDbObject.isForceOverwrite(),uploadDbObject.getLocalAction(),getApplicationContext());
  if (uploadDbObject.isCreateRemoteFolder()) {
    mCurrentUpload.setRemoteFolderToBeCreated();
  }
  mCurrentUpload.addDatatransferProgressListener((FileUploaderBinder)mBinder);
  notifyUploadStart(mCurrentUpload);
  RemoteOperationResult uploadResult=null, grantResult=null;
  try {
    if (mUploadClient == null || !mLastAccount.equals(mCurrentUpload.getAccount())) {
      mLastAccount=mCurrentUpload.getAccount();
      mStorageManager=new FileDataStorageManager(mLastAccount,getContentResolver());
      OwnCloudAccount ocAccount=new OwnCloudAccount(mLastAccount,this);
      mUploadClient=OwnCloudClientManagerFactory.getDefaultSingleton().getClientFor(ocAccount,this);
    }
    String remoteParentPath=new File(mCurrentUpload.getRemotePath()).getParent();
    remoteParentPath=remoteParentPath.endsWith(OCFile.PATH_SEPARATOR) ? remoteParentPath : remoteParentPath + OCFile.PATH_SEPARATOR;
    grantResult=grantFolderExistence(mCurrentUpload,remoteParentPath);
    if (grantResult.isSuccess()) {
      OCFile parent=mStorageManager.getFileByPath(remoteParentPath);
      mCurrentUpload.getFile().setParentId(parent.getFileId());
      uploadResult=mCurrentUpload.execute(mUploadClient);
      if (uploadResult.isSuccess()) {
        saveUploadedFile(mCurrentUpload);
      }
    }
 else {
      uploadResult=grantResult;
    }
  }
 catch (  AccountsException e) {
    Log_OC.e(TAG,"Error while trying to get autorization for " + mLastAccount.name,e);
    uploadResult=new RemoteOperationResult(e);
  }
catch (  IOException e) {
    Log_OC.e(TAG,"Error while trying to get autorization for " + mLastAccount.name,e);
    uploadResult=new RemoteOperationResult(e);
  }
 finally {
    Log_OC.i(TAG,"Remove CurrentUploadItem from pending upload Item Map.");
    if (uploadResult.isException()) {
      mUploadClient=null;
    }
  }
  return uploadResult;
}
