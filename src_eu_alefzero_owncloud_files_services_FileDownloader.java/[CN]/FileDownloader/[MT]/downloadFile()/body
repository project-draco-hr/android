{
  AccountManager am=(AccountManager)getSystemService(ACCOUNT_SERVICE);
  WebdavClient wdc=new WebdavClient(mAccount,getApplicationContext());
  String username=mAccount.name.split("@")[0];
  String password="";
  try {
    password=am.blockingGetAuthToken(mAccount,AccountAuthenticator.AUTH_TOKEN_TYPE,true);
  }
 catch (  Exception e) {
    e.printStackTrace();
    return;
  }
  wdc.setCredentials(username,password);
  wdc.allowSelfsignedCertificates();
  wdc.setDataTransferProgressListener(this);
  mNotification=new Notification(R.drawable.icon,"Downloading file",System.currentTimeMillis());
  mNotification.flags|=Notification.FLAG_ONGOING_EVENT;
  mNotification.contentView=new RemoteViews(getApplicationContext().getPackageName(),R.layout.progressbar_layout);
  mNotification.contentView.setProgressBar(R.id.status_progress,100,0,mTotalDownloadSize == -1);
  mNotification.contentView.setImageViewResource(R.id.status_icon,R.drawable.icon);
  mNotification.contentIntent=PendingIntent.getActivity(getApplicationContext(),0,new Intent(),PendingIntent.FLAG_UPDATE_CURRENT);
  mNotificationMngr.notify(1,mNotification);
  File sdCard=Environment.getExternalStorageDirectory();
  File file=new File(sdCard.getAbsolutePath() + "/owncloud/" + mAccount.name+ mFilePath);
  try {
    file.getParentFile().mkdirs();
    file.createNewFile();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  String message;
  if (wdc.downloadFile(mRemotePath,file)) {
    ContentValues cv=new ContentValues();
    cv.put(ProviderTableMeta.FILE_STORAGE_PATH,file.getAbsolutePath());
    getContentResolver().update(ProviderTableMeta.CONTENT_URI,cv,ProviderTableMeta.FILE_NAME + "=? AND " + ProviderTableMeta.FILE_ACCOUNT_OWNER+ "=?",new String[]{mFilePath.substring(mFilePath.lastIndexOf('/') + 1),mAccount.name});
    message=DOWNLOAD_FINISH_MESSAGE;
  }
 else {
    message=BAD_DOWNLOAD_MESSAGE;
  }
  mNotificationMngr.cancel(1);
  Intent end=new Intent(message);
  end.putExtra(EXTRA_FILE_PATH,file.getAbsolutePath());
  sendBroadcast(end);
}
