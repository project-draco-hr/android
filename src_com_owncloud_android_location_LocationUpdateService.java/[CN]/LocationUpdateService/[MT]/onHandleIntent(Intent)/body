{
  mLocationManager=(LocationManager)getSystemService(LOCATION_SERVICE);
  Criteria criteria=new Criteria();
  criteria.setAccuracy(Criteria.ACCURACY_FINE);
  criteria.setPowerRequirement(Criteria.POWER_LOW);
  mLocationProvider=mLocationManager.getProvider(mLocationManager.getBestProvider(criteria,true));
  if (mLocationProvider == null) {
    String message=String.format(getString(R.string.location_no_provider),getString(R.string.app_name));
    Toast.makeText(this,message,Toast.LENGTH_LONG).show();
    stopSelf();
    return;
  }
  mPreferences=PreferenceManager.getDefaultSharedPreferences(this);
  boolean trackDevice=mPreferences.getBoolean("enable_devicetracking",true);
  int updateIntervall=Integer.parseInt(mPreferences.getString("devicetracking_update_intervall","30")) * 60 * 1000;
  int distanceBetweenLocationChecks=50;
  if (!trackDevice) {
    Log.d(TAG,"Devicetracking is disabled");
    stopSelf();
    return;
  }
  mLocationManager.requestLocationUpdates(mLocationProvider.getName(),updateIntervall,distanceBetweenLocationChecks,this);
}
