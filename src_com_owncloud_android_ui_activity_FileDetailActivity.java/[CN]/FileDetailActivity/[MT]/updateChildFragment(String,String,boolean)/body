{
  Fragment fragment=getSupportFragmentManager().findFragmentByTag(FileDetailFragment.FTAG);
  if (fragment != null && fragment instanceof FileDetailFragment) {
    FileDetailFragment detailsFragment=(FileDetailFragment)fragment;
    OCFile fileInFragment=detailsFragment.getFile();
    if (fileInFragment != null && !downloadedRemotePath.equals(fileInFragment.getRemotePath())) {
      mWaitingToPreview=false;
    }
 else     if (downloadEvent.equals(FileDownloader.DOWNLOAD_ADDED_MESSAGE)) {
      detailsFragment.listenForTransferProgress();
      detailsFragment.updateFileDetails(true,false);
    }
 else     if (downloadEvent.equals(FileDownloader.DOWNLOAD_FINISH_MESSAGE)) {
      if (success && mWaitingToPreview) {
        mFile=mStorageManager.getFileById(mFile.getFileId());
        FragmentTransaction transaction=getSupportFragmentManager().beginTransaction();
        transaction.replace(R.id.fragment,new PreviewMediaFragment(mFile,mAccount,0,true),FileDetailFragment.FTAG);
        transaction.commit();
        mWaitingToPreview=false;
      }
 else {
        detailsFragment.updateFileDetails(false,(success));
      }
    }
  }
}
