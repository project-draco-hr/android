{
  int mode=getIntent().getIntExtra(EXTRA_MODE,MODE_PREVIEW);
  Fragment newFragment=null;
  OCFile file=getFile();
  Account account=getAccount();
  if (mode == MODE_DETAILS) {
    newFragment=new FileDetailFragment(file,account);
  }
 else   if (file.isDown()) {
    if (PreviewMediaFragment.canBePreviewed(file)) {
      int startPlaybackPosition=getIntent().getIntExtra(PreviewVideoActivity.EXTRA_START_POSITION,0);
      boolean autoplay=getIntent().getBooleanExtra(PreviewVideoActivity.EXTRA_AUTOPLAY,true);
      newFragment=new PreviewMediaFragment(file,account,startPlaybackPosition,autoplay);
    }
 else {
      newFragment=new FileDetailFragment(file,account);
    }
  }
 else {
    newFragment=new FileDetailFragment(file,account);
    mWaitingToPreview=true;
  }
  FragmentTransaction ft=getSupportFragmentManager().beginTransaction();
  ft.replace(R.id.fragment,newFragment,FileDetailFragment.FTAG);
  ft.commit();
}
