{
  file=params[0];
  final String imageKey=String.valueOf(file.getRemoteId().hashCode());
  Log_OC.d("Thumbnail",imageKey);
  Bitmap thumbnail=getBitmapFromDiskCache(imageKey);
  if (thumbnail == null) {
    Resources r=mContext.getResources();
    int px=(int)Math.round(TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,150,r.getDisplayMetrics()));
    if (file.isDown()) {
      Bitmap bitmap=BitmapFactory.decodeFile(file.getStoragePath());
      if (bitmap != null) {
        thumbnail=ThumbnailUtils.extractThumbnail(bitmap,px,px);
        addBitmapToCache(imageKey,thumbnail);
      }
    }
 else {
      try {
        int status=-1;
        String uri=client.getBaseUri() + "/index.php/apps/files/api/v1/thumbnail/100/100/" + URLEncoder.encode(file.getRemotePath(),"UTF-8").replaceAll("%2F","/");
        Log_OC.d("Thumbnail","URI: " + uri);
        GetMethod get=new GetMethod(uri);
        status=client.executeMethod(get);
        if (status == HttpStatus.SC_OK) {
          byte[] bytes=get.getResponseBody();
          Bitmap bitmap=BitmapFactory.decodeByteArray(bytes,0,bytes.length);
          thumbnail=ThumbnailUtils.extractThumbnail(bitmap,px,px);
          if (thumbnail != null) {
            addBitmapToCache(imageKey,thumbnail);
          }
        }
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
  return thumbnail;
}
