{
  super.onCreateContextMenu(menu,v,menuInfo);
  MenuInflater inflater=getActivity().getMenuInflater();
  inflater.inflate(R.menu.file_actions_menu,menu);
  AdapterContextMenuInfo info=(AdapterContextMenuInfo)menuInfo;
  OCFile targetFile=(OCFile)mAdapter.getItem(info.position);
  List<Integer> toHide=new ArrayList<Integer>();
  List<Integer> toDisable=new ArrayList<Integer>();
  MenuItem item=null;
  if (targetFile.isDirectory()) {
    toHide.add(R.id.action_open_file_with);
    toHide.add(R.id.action_download_file);
    toHide.add(R.id.action_cancel_download);
    toHide.add(R.id.action_cancel_upload);
    toHide.add(R.id.action_see_details);
    if (mContainerActivity.getFileDownloaderBinder().isDownloading(AccountUtils.getCurrentOwnCloudAccount(getActivity()),targetFile) || mContainerActivity.getFileUploaderBinder().isUploading(AccountUtils.getCurrentOwnCloudAccount(getActivity()),targetFile)) {
      toDisable.add(R.id.action_rename_file);
      toDisable.add(R.id.action_remove_file);
    }
  }
 else {
    if (targetFile.isDown()) {
      toHide.add(R.id.action_cancel_download);
      toHide.add(R.id.action_cancel_upload);
      item=menu.findItem(R.id.action_download_file);
      if (item != null) {
        item.setTitle(R.string.filedetails_sync_file);
      }
    }
 else {
      toHide.add(R.id.action_open_file_with);
    }
    if (mContainerActivity.getFileDownloaderBinder().isDownloading(AccountUtils.getCurrentOwnCloudAccount(getActivity()),targetFile)) {
      toHide.add(R.id.action_download_file);
      toHide.add(R.id.action_cancel_upload);
      toDisable.add(R.id.action_open_file_with);
      toDisable.add(R.id.action_rename_file);
      toDisable.add(R.id.action_remove_file);
    }
 else     if (mContainerActivity.getFileUploaderBinder().isUploading(AccountUtils.getCurrentOwnCloudAccount(getActivity()),targetFile)) {
      toHide.add(R.id.action_download_file);
      toHide.add(R.id.action_cancel_download);
      toDisable.add(R.id.action_open_file_with);
      toDisable.add(R.id.action_rename_file);
      toDisable.add(R.id.action_remove_file);
    }
 else {
      toHide.add(R.id.action_cancel_download);
      toHide.add(R.id.action_cancel_upload);
    }
  }
  for (  int i : toHide) {
    item=menu.findItem(i);
    if (item != null) {
      item.setVisible(false);
      item.setEnabled(false);
    }
  }
  for (  int i : toDisable) {
    item=menu.findItem(i);
    if (item != null) {
      item.setEnabled(false);
    }
  }
}
