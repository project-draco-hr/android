{
  getListView().setMultiChoiceModeListener(new AbsListView.MultiChoiceModeListener(){
    @Override public void onItemCheckedStateChanged(    ActionMode mode,    int position,    long id,    boolean checked){
      final int checkedCount=getListView().getCheckedItemCount();
      mode.setTitle(checkedCount + " Selected");
      if (checked) {
        mAdapter.setNewSelection(position,checked);
      }
 else {
        mAdapter.removeSelection(position);
      }
    }
    @Override public boolean onCreateActionMode(    ActionMode mode,    Menu menu){
      mode.getMenuInflater().inflate(R.menu.file_actions_menu,menu);
      return true;
    }
    @Override public boolean onPrepareActionMode(    ActionMode mode,    Menu menu){
      return false;
    }
    @Override public boolean onActionItemClicked(    ActionMode mode,    MenuItem item){
      if (mAdapter.getCheckedItemPositions().size() == 1) {
        return onFileActionChosen(item.getItemId(),mAdapter.getCheckedItemPositions().get(0));
      }
 else       if (mAdapter.getCheckedItemPositions().size() > 1) {
        return false;
      }
      return false;
    }
    @Override public void onDestroyActionMode(    ActionMode mode){
      mAdapter.removeSelection();
    }
  }
);
}
