{
  if (!PreferenceManager.getDefaultSharedPreferences(context).getBoolean("instant_uploading",false)) {
    Log.d(TAG,"Instant upload disabled, abording uploading");
    return;
  }
  if (!intent.getAction().equals(NEW_PHOTO_ACTION)) {
    Log.e(TAG,"Incorrect intent sent: " + intent.getAction());
    return;
  }
  Account account=AccountUtils.getCurrentOwnCloudAccount(context);
  if (account == null) {
    Log.w(TAG,"No owncloud account found for instant upload, abording");
    return;
  }
  Cursor c=context.getContentResolver().query(intent.getData(),CONTENT_PROJECTION,null,null,null);
  if (!c.moveToFirst()) {
    Log.e(TAG,"Couldn't resolve given uri!");
    return;
  }
  String file_path=c.getString(c.getColumnIndex(Media.DATA));
  String file_name=c.getString(c.getColumnIndex(Media.DISPLAY_NAME));
  String mime_type=c.getString(c.getColumnIndex(Media.MIME_TYPE));
  long file_size=c.getLong(c.getColumnIndex(Media.SIZE));
  c.close();
  Intent upload_intent=new Intent(context,InstantUploadService.class);
  upload_intent.putExtra(InstantUploadService.KEY_ACCOUNT,account);
  upload_intent.putExtra(InstantUploadService.KEY_FILE_PATH,file_path);
  upload_intent.putExtra(InstantUploadService.KEY_DISPLAY_NAME,file_name);
  upload_intent.putExtra(InstantUploadService.KEY_FILE_SIZE,file_size);
  upload_intent.putExtra(InstantUploadService.KEY_MIME_TYPE,mime_type);
  context.startService(upload_intent);
}
