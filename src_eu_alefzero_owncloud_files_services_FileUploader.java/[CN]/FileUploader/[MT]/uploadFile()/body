{
  FileDataStorageManager storageManager=new FileDataStorageManager(mAccount,getContentResolver());
  mTotalDataToSend=mSendData=mPreviousPercent=0;
  mNotification=new Notification(eu.alefzero.owncloud.R.drawable.icon,"Uploading...",System.currentTimeMillis());
  mNotification.flags|=Notification.FLAG_ONGOING_EVENT;
  mNotification.contentView=new RemoteViews(getApplicationContext().getPackageName(),R.layout.progressbar_layout);
  mNotification.contentView.setProgressBar(R.id.status_progress,100,0,false);
  mNotification.contentView.setImageViewResource(R.id.status_icon,R.drawable.icon);
  mNotification.contentIntent=PendingIntent.getActivity(getApplicationContext(),0,new Intent(),PendingIntent.FLAG_UPDATE_CURRENT);
  mNotificationManager.notify(42,mNotification);
  WebdavClient wc=new WebdavClient(mAccount,getApplicationContext());
  wc.allowSelfsignedCertificates();
  wc.setDataTransferProgressListener(this);
  for (int i=0; i < mLocalPaths.length; ++i) {
    File f=new File(mLocalPaths[i]);
    mTotalDataToSend+=f.length();
  }
  Log.d(TAG,"Will upload " + mTotalDataToSend + " bytes, with "+ mLocalPaths.length+ " files");
  mSuccessCounter=0;
  for (int i=0; i < mLocalPaths.length; ++i) {
    String mimeType=null;
    try {
      mimeType=MimeTypeMap.getSingleton().getMimeTypeFromExtension(mLocalPaths[i].substring(mLocalPaths[i].lastIndexOf('.') + 1));
    }
 catch (    IndexOutOfBoundsException e) {
      Log.e(TAG,"Trying to find out MIME type of a file without extension: " + mLocalPaths[i]);
    }
    if (mimeType == null)     mimeType="application/octet-stream";
    mCurrentIndexUpload=i;
    mRemotePaths[i]=getAvailableRemotePath(wc,mRemotePaths[i]);
    if (mRemotePaths[i] != null && wc.putFile(mLocalPaths[i],mRemotePaths[i],mimeType)) {
      mSuccessCounter++;
      OCFile new_file=new OCFile(mRemotePaths[i]);
      new_file.setMimetype(mimeType);
      new_file.setFileLength(new File(mLocalPaths[i]).length());
      new_file.setModificationTimestamp(System.currentTimeMillis());
      new_file.setLastSyncDate(0);
      new_file.setStoragePath(mLocalPaths[i]);
      File f=new File(mRemotePaths[i]);
      long parentDirId=storageManager.getFileByPath(f.getParent().endsWith("/") ? f.getParent() : f.getParent() + "/").getFileId();
      new_file.setParentId(parentDirId);
      storageManager.saveFile(new_file);
      Intent end=new Intent(UPLOAD_FINISH_MESSAGE);
      end.putExtra(EXTRA_PARENT_DIR_ID,parentDirId);
      end.putExtra(ACCOUNT_NAME,mAccount.name);
      sendBroadcast(end);
    }
  }
  mNotificationManager.cancel(42);
  run();
}
