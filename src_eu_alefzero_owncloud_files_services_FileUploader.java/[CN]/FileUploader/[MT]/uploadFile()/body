{
  String baseUrl=mAccountManager.getUserData(mAccount,AccountAuthenticator.KEY_OC_BASE_URL), ocVerStr=mAccountManager.getUserData(mAccount,AccountAuthenticator.KEY_OC_VERSION);
  OwnCloudVersion ocVer=new OwnCloudVersion(ocVerStr);
  String webdav_path=AccountUtils.getWebdavPath(ocVer);
  Uri ocUri=Uri.parse(baseUrl + webdav_path);
  String username=mAccount.name.substring(0,mAccount.name.lastIndexOf('@'));
  String password=mAccountManager.getPassword(mAccount);
  FileDataStorageManager storageManager=new FileDataStorageManager(mAccount,getContentResolver());
  mTotalDataToSend=mSendData=mPreviousPercent=0;
  mNotification=new Notification(eu.alefzero.owncloud.R.drawable.icon,"Uploading...",System.currentTimeMillis());
  mNotification.flags|=Notification.FLAG_ONGOING_EVENT;
  mNotification.contentView=new RemoteViews(getApplicationContext().getPackageName(),R.layout.progressbar_layout);
  mNotification.contentView.setProgressBar(R.id.status_progress,100,0,false);
  mNotification.contentView.setImageViewResource(R.id.status_icon,R.drawable.icon);
  mNotificationManager.notify(42,mNotification);
  WebdavClient wc=new WebdavClient(ocUri);
  wc.allowSelfsignedCertificates();
  wc.setDataTransferProgressListener(this);
  wc.setCredentials(username,password);
  for (int i=0; i < mLocalPaths.length; ++i) {
    File f=new File(mLocalPaths[i]);
    mTotalDataToSend+=f.length();
  }
  Log.d(TAG,"Will upload " + mTotalDataToSend + " bytes, with "+ mLocalPaths.length+ " files");
  for (int i=0; i < mLocalPaths.length; ++i) {
    String mimeType=MimeTypeMap.getSingleton().getMimeTypeFromExtension(mLocalPaths[i].substring(mLocalPaths[i].lastIndexOf('.') + 1));
    mResult=false;
    mCurrentIndexUpload=i;
    if (wc.putFile(mLocalPaths[i],mRemotePaths[i],mimeType)) {
      mResult|=true;
      OCFile new_file=new OCFile(mRemotePaths[i]);
      new_file.setMimetype(mimeType);
      new_file.setFileLength(new File(mLocalPaths[i]).length());
      new_file.setModificationTimestamp(System.currentTimeMillis());
      new_file.setLastSyncDate(0);
      new_file.setStoragePath(mLocalPaths[i]);
      File f=new File(URLDecoder.decode(mRemotePaths[i]));
      new_file.setParentId(storageManager.getFileByPath(f.getParent().endsWith("/") ? f.getParent() : f.getParent() + "/").getFileId());
      storageManager.saveFile(new_file);
    }
  }
  mNotificationManager.cancel(42);
  run();
}
