{
  mCurrentUpload=mPendingUploads.get(uploadKey);
  if (mCurrentUpload != null) {
    if (AccountUtils.exists(mCurrentUpload.getAccount(),getApplicationContext())) {
      Log_OC.d(TAG,"Account " + mCurrentUpload.getAccount().name + " exists");
      mUploadsStorageManager.updateDatabaseUploadStart(mCurrentUpload);
      notifyUploadStart(mCurrentUpload);
      RemoteOperationResult uploadResult=null, grantResult;
      try {
        if (mCurrentAccount == null || !mCurrentAccount.equals(mCurrentUpload.getAccount())) {
          mCurrentAccount=mCurrentUpload.getAccount();
          mStorageManager=new FileDataStorageManager(mCurrentAccount,getContentResolver());
        }
        OwnCloudAccount ocAccount=new OwnCloudAccount(mCurrentAccount,this);
        mUploadClient=OwnCloudClientManagerFactory.getDefaultSingleton().getClientFor(ocAccount,this);
        String remoteParentPath=new File(mCurrentUpload.getRemotePath()).getParent();
        remoteParentPath=remoteParentPath.endsWith(OCFile.PATH_SEPARATOR) ? remoteParentPath : remoteParentPath + OCFile.PATH_SEPARATOR;
        grantResult=grantFolderExistence(remoteParentPath);
        if (grantResult.isSuccess()) {
          OCFile parent=mStorageManager.getFileByPath(remoteParentPath);
          mCurrentUpload.getFile().setParentId(parent.getFileId());
          uploadResult=mCurrentUpload.execute(mUploadClient);
          if (uploadResult.isSuccess()) {
            saveUploadedFile();
          }
 else           if (uploadResult.getCode() == ResultCode.SYNC_CONFLICT) {
            mStorageManager.saveConflict(mCurrentUpload.getFile(),mCurrentUpload.getFile().getEtagInConflict());
          }
        }
 else {
          uploadResult=grantResult;
        }
      }
 catch (      Exception e) {
        Log_OC.e(TAG,"Error uploading",e);
        uploadResult=new RemoteOperationResult(e);
      }
 finally {
        Pair<UploadFileOperation,String> removeResult;
        if (mCurrentUpload.wasRenamed()) {
          removeResult=mPendingUploads.removePayload(mCurrentAccount.name,mCurrentUpload.getOldFile().getRemotePath());
        }
 else {
          removeResult=mPendingUploads.removePayload(mCurrentAccount.name,mCurrentUpload.getRemotePath());
        }
        mUploadsStorageManager.updateDatabaseUploadResult(uploadResult,mCurrentUpload);
        notifyUploadResult(mCurrentUpload,uploadResult);
        sendBroadcastUploadFinished(mCurrentUpload,uploadResult,removeResult.second);
      }
    }
 else {
      Log_OC.d(TAG,"Account " + mCurrentUpload.getAccount().toString() + " doesn't exist");
      cancelUploadsForAccount(mCurrentUpload.getAccount());
    }
  }
}
