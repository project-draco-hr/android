{
switch (v.getId()) {
case R.id.fdDownloadBtn:
{
      FileDownloaderBinder downloaderBinder=mContainerActivity.getFileDownloaderBinder();
      FileUploaderBinder uploaderBinder=mContainerActivity.getFileUploaderBinder();
      if (downloaderBinder != null && downloaderBinder.isDownloading(mAccount,mFile)) {
        downloaderBinder.cancel(mAccount,mFile);
        if (mFile.isDown()) {
          setButtonsForDown();
        }
 else {
          setButtonsForRemote();
        }
      }
 else       if (uploaderBinder != null && uploaderBinder.isUploading(mAccount,mFile)) {
        uploaderBinder.cancel(mAccount,mFile);
        if (!mFile.fileExists()) {
          if (getActivity() instanceof FileDisplayActivity) {
            FragmentTransaction transaction=getActivity().getSupportFragmentManager().beginTransaction();
            transaction.replace(R.id.file_details_container,new FileDetailFragment(null,null),FTAG);
            transaction.commit();
            mContainerActivity.onFileStateChanged();
          }
 else {
            getActivity().finish();
          }
        }
 else         if (mFile.isDown()) {
          setButtonsForDown();
        }
 else {
          setButtonsForRemote();
        }
      }
 else {
        Intent i=new Intent(getActivity(),FileDownloader.class);
        i.putExtra(FileDownloader.EXTRA_ACCOUNT,mAccount);
        i.putExtra(FileDownloader.EXTRA_FILE,mFile);
        setButtonsForTransferring();
        getActivity().startService(i);
        mContainerActivity.onFileStateChanged();
      }
      break;
    }
case R.id.fdKeepInSync:
{
    CheckBox cb=(CheckBox)getView().findViewById(R.id.fdKeepInSync);
    mFile.setKeepInSync(cb.isChecked());
    FileDataStorageManager fdsm=new FileDataStorageManager(mAccount,getActivity().getApplicationContext().getContentResolver());
    fdsm.saveFile(mFile);
    if (mFile.keepInSync()) {
      onClick(getView().findViewById(R.id.fdDownloadBtn));
    }
 else {
      mContainerActivity.onFileStateChanged();
    }
    Intent intent=new Intent(getActivity().getApplicationContext(),FileObserverService.class);
    intent.putExtra(FileObserverService.KEY_FILE_CMD,(cb.isChecked() ? FileObserverService.CMD_ADD_OBSERVED_FILE : FileObserverService.CMD_DEL_OBSERVED_FILE));
    String localPath=mFile.getStoragePath();
    if (localPath == null || localPath.length() <= 0) {
      localPath=FileStorageUtils.getDefaultSavePathFor(mAccount.name,mFile);
    }
    intent.putExtra(FileObserverService.KEY_CMD_ARG,localPath);
    Log.e(TAG,"starting observer service");
    getActivity().startService(intent);
    break;
  }
case R.id.fdRenameBtn:
{
  EditNameDialog dialog=EditNameDialog.newInstance(mFile.getFileName());
  dialog.setOnDismissListener(this);
  dialog.show(getFragmentManager(),"nameeditdialog");
  break;
}
case R.id.fdRemoveBtn:
{
ConfirmationDialogFragment confDialog=ConfirmationDialogFragment.newInstance(R.string.confirmation_remove_alert,new String[]{mFile.getFileName()},mFile.isDown() ? R.string.confirmation_remove_remote_and_local : R.string.confirmation_remove_remote,mFile.isDown() ? R.string.confirmation_remove_local : -1,R.string.common_cancel);
confDialog.setOnConfirmationListener(this);
confDialog.show(getFragmentManager(),FTAG_CONFIRMATION);
break;
}
case R.id.fdOpenBtn:
{
String storagePath=mFile.getStoragePath();
String encodedStoragePath=WebdavUtils.encodePath(storagePath);
try {
Intent i=new Intent(Intent.ACTION_VIEW);
i.setDataAndType(Uri.parse("file://" + encodedStoragePath),mFile.getMimetype());
i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
startActivity(i);
}
 catch (Throwable t) {
Log.e(TAG,"Fail when trying to open with the mimeType provided from the ownCloud server: " + mFile.getMimetype());
boolean toastIt=true;
String mimeType="";
try {
  Intent i=new Intent(Intent.ACTION_VIEW);
  mimeType=MimeTypeMap.getSingleton().getMimeTypeFromExtension(storagePath.substring(storagePath.lastIndexOf('.') + 1));
  if (mimeType != null && !mimeType.equals(mFile.getMimetype())) {
    i.setDataAndType(Uri.parse("file://" + encodedStoragePath),mimeType);
    i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
    startActivity(i);
    toastIt=false;
  }
}
 catch (IndexOutOfBoundsException e) {
  Log.e(TAG,"Trying to find out MIME type of a file without extension: " + storagePath);
}
catch (ActivityNotFoundException e) {
  Log.e(TAG,"No activity found to handle: " + storagePath + " with MIME type "+ mimeType+ " obtained from extension");
}
catch (Throwable th) {
  Log.e(TAG,"Unexpected problem when opening: " + storagePath,th);
}
 finally {
  if (toastIt) {
    Toast.makeText(getActivity(),"There is no application to handle file " + mFile.getFileName(),Toast.LENGTH_SHORT).show();
  }
}
}
break;
}
default :
Log.e(TAG,"Incorrect view clicked!");
}
}
