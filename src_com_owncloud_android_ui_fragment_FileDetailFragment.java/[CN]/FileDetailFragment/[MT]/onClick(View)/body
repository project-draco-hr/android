{
switch (v.getId()) {
case R.id.fdDownloadBtn:
{
      FileDownloaderBinder downloaderBinder=mContainerActivity.getFileDownloaderBinder();
      FileUploaderBinder uploaderBinder=mContainerActivity.getFileUploaderBinder();
      if (downloaderBinder != null && downloaderBinder.isDownloading(mAccount,mFile)) {
        downloaderBinder.cancel(mAccount,mFile);
        if (mFile.isDown()) {
          setButtonsForDown();
        }
 else {
          setButtonsForRemote();
        }
      }
 else       if (uploaderBinder != null && uploaderBinder.isUploading(mAccount,mFile)) {
        uploaderBinder.cancel(mAccount,mFile);
        if (!mFile.fileExists()) {
          if (getActivity() instanceof FileDisplayActivity) {
            FragmentTransaction transaction=getActivity().getSupportFragmentManager().beginTransaction();
            transaction.replace(R.id.file_details_container,new FileDetailFragment(null,null),FTAG);
            transaction.commit();
            mContainerActivity.onFileStateChanged();
          }
 else {
            getActivity().finish();
          }
        }
 else         if (mFile.isDown()) {
          setButtonsForDown();
        }
 else {
          setButtonsForRemote();
        }
      }
 else {
        mLastRemoteOperation=new SynchronizeFileOperation(mFile,null,mStorageManager,mAccount,true,false,getActivity());
        WebdavClient wc=OwnCloudClientUtils.createOwnCloudClient(mAccount,getSherlockActivity().getApplicationContext());
        mLastRemoteOperation.execute(wc,this,mHandler);
        boolean inDisplayActivity=getActivity() instanceof FileDisplayActivity;
        getActivity().showDialog((inDisplayActivity) ? FileDisplayActivity.DIALOG_SHORT_WAIT : FileDetailActivity.DIALOG_SHORT_WAIT);
        setButtonsForTransferring();
      }
      break;
    }
case R.id.fdKeepInSync:
{
    CheckBox cb=(CheckBox)getView().findViewById(R.id.fdKeepInSync);
    mFile.setKeepInSync(cb.isChecked());
    mStorageManager.saveFile(mFile);
    Intent intent=new Intent(getActivity().getApplicationContext(),FileObserverService.class);
    intent.putExtra(FileObserverService.KEY_FILE_CMD,(cb.isChecked() ? FileObserverService.CMD_ADD_OBSERVED_FILE : FileObserverService.CMD_DEL_OBSERVED_FILE));
    intent.putExtra(FileObserverService.KEY_CMD_ARG_FILE,mFile);
    intent.putExtra(FileObserverService.KEY_CMD_ARG_ACCOUNT,mAccount);
    Log_OC.e(TAG,"starting observer service");
    getActivity().startService(intent);
    if (mFile.keepInSync()) {
      onClick(getView().findViewById(R.id.fdDownloadBtn));
    }
    break;
  }
case R.id.fdRenameBtn:
{
  EditNameDialog dialog=EditNameDialog.newInstance(getString(R.string.rename_dialog_title),mFile.getFileName(),this);
  dialog.show(getFragmentManager(),"nameeditdialog");
  break;
}
case R.id.fdRemoveBtn:
{
ConfirmationDialogFragment confDialog=ConfirmationDialogFragment.newInstance(R.string.confirmation_remove_alert,new String[]{mFile.getFileName()},mFile.isDown() ? R.string.confirmation_remove_remote_and_local : R.string.confirmation_remove_remote,mFile.isDown() ? R.string.confirmation_remove_local : -1,R.string.common_cancel);
confDialog.setOnConfirmationListener(this);
mCurrentDialog=confDialog;
mCurrentDialog.show(getFragmentManager(),FTAG_CONFIRMATION);
break;
}
case R.id.fdOpenBtn:
{
String storagePath=mFile.getStoragePath();
String encodedStoragePath=WebdavUtils.encodePath(storagePath);
try {
Intent i=new Intent(Intent.ACTION_VIEW);
i.setDataAndType(Uri.parse("file://" + encodedStoragePath),mFile.getMimetype());
i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
startActivity(i);
}
 catch (Throwable t) {
Log_OC.e(TAG,"Fail when trying to open with the mimeType provided from the ownCloud server: " + mFile.getMimetype());
boolean toastIt=true;
String mimeType="";
try {
  Intent i=new Intent(Intent.ACTION_VIEW);
  mimeType=MimeTypeMap.getSingleton().getMimeTypeFromExtension(storagePath.substring(storagePath.lastIndexOf('.') + 1));
  if (mimeType == null || !mimeType.equals(mFile.getMimetype())) {
    if (mimeType != null) {
      i.setDataAndType(Uri.parse("file://" + encodedStoragePath),mimeType);
    }
 else {
      i.setDataAndType(Uri.parse("file://" + encodedStoragePath),"*/*");
    }
    i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
    startActivity(i);
    toastIt=false;
  }
}
 catch (IndexOutOfBoundsException e) {
  Log_OC.e(TAG,"Trying to find out MIME type of a file without extension: " + storagePath);
}
catch (ActivityNotFoundException e) {
  Log_OC.e(TAG,"No activity found to handle: " + storagePath + " with MIME type "+ mimeType+ " obtained from extension");
}
catch (Throwable th) {
  Log_OC.e(TAG,"Unexpected problem when opening: " + storagePath,th);
}
 finally {
  if (toastIt) {
    Toast.makeText(getActivity(),"There is no application to handle file " + mFile.getFileName(),Toast.LENGTH_SHORT).show();
  }
}
}
break;
}
default :
Log_OC.e(TAG,"Incorrect view clicked!");
}
}
