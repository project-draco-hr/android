{
  super.onPrepareOptionsMenu(menu);
  List<Integer> toHide=new ArrayList<Integer>();
  List<Integer> toShow=new ArrayList<Integer>();
  FileDownloaderBinder downloaderBinder=mContainerActivity.getFileDownloaderBinder();
  boolean downloading=downloaderBinder != null && downloaderBinder.isDownloading(mAccount,mFile);
  FileUploaderBinder uploaderBinder=mContainerActivity.getFileUploaderBinder();
  boolean uploading=uploaderBinder != null && uploaderBinder.isUploading(mAccount,mFile);
  if (downloading || uploading) {
    toHide.add(R.id.action_download_file);
    toHide.add(R.id.action_rename_file);
    toHide.add(R.id.action_remove_file);
    toHide.add(R.id.action_open_file_with);
    if (!downloading) {
      toHide.add(R.id.action_cancel_download);
      toShow.add(R.id.action_cancel_upload);
    }
 else {
      toHide.add(R.id.action_cancel_upload);
      toShow.add(R.id.action_cancel_download);
    }
  }
 else   if (mFile != null && mFile.isDown()) {
    toHide.add(R.id.action_download_file);
    toHide.add(R.id.action_cancel_download);
    toHide.add(R.id.action_cancel_upload);
    toShow.add(R.id.action_rename_file);
    toShow.add(R.id.action_remove_file);
    toShow.add(R.id.action_open_file_with);
    toShow.add(R.id.action_sync_file);
  }
 else {
    toHide.add(R.id.action_open_file_with);
    toHide.add(R.id.action_cancel_download);
    toHide.add(R.id.action_cancel_upload);
    toHide.add(R.id.action_sync_file);
    toShow.add(R.id.action_rename_file);
    toShow.add(R.id.action_remove_file);
    toShow.add(R.id.action_download_file);
  }
  MenuItem item=null;
  for (  int i : toHide) {
    item=menu.findItem(i);
    if (item != null) {
      item.setVisible(false);
      item.setEnabled(false);
    }
  }
  for (  int i : toShow) {
    item=menu.findItem(i);
    if (item != null) {
      item.setVisible(true);
      item.setEnabled(true);
    }
  }
}
