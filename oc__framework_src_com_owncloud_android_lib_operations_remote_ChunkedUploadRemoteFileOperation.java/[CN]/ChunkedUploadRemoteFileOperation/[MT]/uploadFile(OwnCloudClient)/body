{
  int status=-1;
  FileChannel channel=null;
  RandomAccessFile raf=null;
  try {
    File file=new File(mStoragePath);
    raf=new RandomAccessFile(file,"r");
    channel=raf.getChannel();
    mEntity=new ChunkFromFileChannelRequestEntity(channel,mMimeType,CHUNK_SIZE,file);
synchronized (mDataTransferListeners) {
      ((ProgressiveDataTransferer)mEntity).addDatatransferProgressListeners(mDataTransferListeners);
    }
    long offset=0;
    String uriPrefix=client.getBaseUri() + WebdavUtils.encodePath(mRemotePath) + "-chunking-"+ Math.abs((new Random()).nextInt(9000) + 1000)+ "-";
    long chunkCount=(long)Math.ceil((double)file.length() / CHUNK_SIZE);
    for (int chunkIndex=0; chunkIndex < chunkCount; chunkIndex++, offset+=CHUNK_SIZE) {
      if (mPutMethod != null) {
        mPutMethod.releaseConnection();
      }
      mPutMethod=new PutMethod(uriPrefix + chunkCount + "-"+ chunkIndex);
      mPutMethod.addRequestHeader(OC_CHUNKED_HEADER,OC_CHUNKED_HEADER);
      ((ChunkFromFileChannelRequestEntity)mEntity).setOffset(offset);
      mPutMethod.setRequestEntity(mEntity);
      status=client.executeMethod(mPutMethod);
      client.exhaustResponse(mPutMethod.getResponseBodyAsStream());
      Log.d(TAG,"Upload of " + mStoragePath + " to "+ mRemotePath+ ", chunk index "+ chunkIndex+ ", count "+ chunkCount+ ", HTTP result status "+ status);
      if (!isSuccess(status))       break;
    }
  }
  finally {
    if (channel != null)     channel.close();
    if (raf != null)     raf.close();
    if (mPutMethod != null)     mPutMethod.releaseConnection();
  }
  return status;
}
