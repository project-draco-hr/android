{
  View view=convertView;
  if (view == null) {
    LayoutInflater inflator=(LayoutInflater)mParentActivity.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    view=inflator.inflate(R.layout.upload_list_item,null);
  }
  if (uploadsItems != null && uploadsItems.length > position) {
    final OCUpload upload=uploadsItems[position];
    TextView fileName=(TextView)view.findViewById(R.id.upload_name);
    String file=upload.getOCFile().getFileName();
    fileName.setText(file);
    TextView localPath=(TextView)view.findViewById(R.id.upload_local_path);
    String path=upload.getOCFile().getStoragePath();
    path=path == null ? "" : path.substring(0,path.length() - file.length() - 1);
    localPath.setText("Path: " + path);
    TextView fileSize=(TextView)view.findViewById(R.id.upload_file_size);
    fileSize.setText(DisplayUtils.bytesToHumanReadable(upload.getOCFile().getFileLength()));
    TextView statusView=(TextView)view.findViewById(R.id.upload_status);
    String status;
switch (upload.getUploadStatus()) {
case UPLOAD_IN_PROGRESS:
      status=mParentActivity.getString(R.string.uploader_upload_in_progress_ticker);
    ProgressBar progressBar=(ProgressBar)view.findViewById(R.id.upload_progress_bar);
  progressBar.setProgress(0);
progressBar.setVisibility(View.VISIBLE);
mProgressListener=new ProgressListener(progressBar);
if (mParentActivity.getFileUploaderBinder() != null) {
mParentActivity.getFileUploaderBinder().addDatatransferProgressListener(mProgressListener,mParentActivity.getAccount(),upload.getOCFile());
}
 else {
Log_OC.e(TAG,"UploadBinder == null. It should have been created on creating mParentActivity" + " which inherits from FileActivity. Fix that!");
Log_OC.e(TAG,"PENDING BINDING for upload = " + upload.getLocalPath());
}
break;
case UPLOAD_FAILED_GIVE_UP:
if (upload.getLastResult() != null) {
status="Upload failed: " + upload.getLastResult().toString();
}
 else {
status="Upload failed.";
}
break;
case UPLOAD_FAILED_RETRY:
if (upload.getLastResult() != null) {
status="Last failure: " + upload.getLastResult().toString();
}
 else {
status="Upload will be retried shortly.";
}
String laterReason=FileUploadService.getUploadLaterReason(mParentActivity,upload);
if (laterReason != null) {
status+="\n" + laterReason;
}
break;
case UPLOAD_LATER:
status=FileUploadService.getUploadLaterReason(mParentActivity,upload);
break;
case UPLOAD_SUCCEEDED:
status="Completed.";
break;
case UPLOAD_CANCELLED:
status="Upload cancelled.";
break;
case UPLOAD_PAUSED:
status="Upload paused.";
break;
default :
status=upload.getUploadStatus().toString();
if (upload.getLastResult() != null) {
upload.getLastResult().toString();
}
break;
}
if (upload.getUploadStatus() != UploadStatus.UPLOAD_IN_PROGRESS) {
ProgressBar progressBar=(ProgressBar)view.findViewById(R.id.upload_progress_bar);
progressBar.setVisibility(View.GONE);
if (mParentActivity.getFileUploaderBinder() != null && mProgressListener != null && mCurrentUpload != null) {
OCFile currentOcFile=mCurrentUpload.getFile();
mParentActivity.getFileUploaderBinder().removeDatatransferProgressListener(mProgressListener,upload.getAccount(mParentActivity),currentOcFile);
mProgressListener=null;
mCurrentUpload=null;
}
}
statusView.setText(status);
ImageButton rightButton=(ImageButton)view.findViewById(R.id.upload_right_button);
if (upload.userCanRetryUpload() && upload.getUploadStatus() != UploadStatus.UPLOAD_SUCCEEDED) {
rightButton.setImageDrawable(mParentActivity.getDrawable(R.drawable.ic_action_refresh_grey));
rightButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View v){
}
}
);
}
 else if (upload.userCanCancelUpload()) {
rightButton.setImageDrawable(mParentActivity.getDrawable(R.drawable.ic_cancel));
rightButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View v){
mParentActivity.getFileOperationsHelper().cancelTransference(upload.getOCFile());
}
}
);
}
 else {
rightButton.setImageDrawable(mParentActivity.getDrawable(R.drawable.ic_delete));
rightButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View v){
mParentActivity.getFileOperationsHelper().removeUploadFromList(upload);
}
}
);
}
ImageView fileIcon=(ImageView)view.findViewById(R.id.imageView1);
fileIcon.setImageResource(R.drawable.file);
try {
Bitmap b=ThumbnailsCacheManager.getBitmapFromDiskCache(upload.getOCFile().getRemoteId());
if (b != null) {
fileIcon.setImageBitmap(b);
}
}
 catch (NullPointerException e) {
}
TextView uploadDate=(TextView)view.findViewById(R.id.upload_date);
CharSequence dateString=DisplayUtils.getRelativeDateTimeString(mParentActivity,upload.getUploadTime().getTimeInMillis(),DateUtils.SECOND_IN_MILLIS,DateUtils.WEEK_IN_MILLIS,0);
uploadDate.setText(dateString);
}
return view;
}
