{
  View view=convertView;
  if (view == null) {
    LayoutInflater inflator=(LayoutInflater)mParentActivity.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    view=inflator.inflate(R.layout.upload_list_item,null);
  }
  if (uploadsItems != null && uploadsItems.length > position) {
    final UploadDbObject uploadObject=uploadsItems[position];
    TextView fileName=(TextView)view.findViewById(R.id.upload_name);
    String file=uploadObject.getOCFile().getFileName();
    fileName.setText(file);
    TextView localPath=(TextView)view.findViewById(R.id.upload_local_path);
    String path=uploadObject.getOCFile().getStoragePath();
    path=path.substring(0,path.length() - file.length() - 1);
    localPath.setText("Path: " + path);
    TextView fileSize=(TextView)view.findViewById(R.id.upload_file_size);
    fileSize.setText(DisplayUtils.bytesToHumanReadable(uploadObject.getOCFile().getFileLength()));
    TextView statusView=(TextView)view.findViewById(R.id.upload_status);
    String status;
switch (uploadObject.getUploadStatus()) {
case UPLOAD_IN_PROGRESS:
      status=mParentActivity.getString(R.string.uploader_upload_in_progress_ticker);
    ProgressBar progressBar=(ProgressBar)view.findViewById(R.id.upload_progress_bar);
  progressBar.setProgress(0);
progressBar.setVisibility(View.VISIBLE);
mProgressListener=new ProgressListener(progressBar);
if (mParentActivity.getFileUploaderBinder() != null) {
mCurrentUpload=mParentActivity.getFileUploaderBinder().getCurrentUploadOperation();
if (mCurrentUpload != null) {
mCurrentUpload.addDatatransferProgressListener(mProgressListener);
Log_OC.d(TAG,"added progress listener for current upload: " + mCurrentUpload);
}
 else {
Log_OC.w(TAG,"getFileUploaderBinder().getCurrentUploadOperation() return null. That is odd.");
}
}
 else {
Log_OC.e(TAG,"UploadBinder == null. It should have been created on creating mParentActivity" + " which inherits from FileActivity. Fix that!");
}
break;
case UPLOAD_FAILED_GIVE_UP:
if (uploadObject.getLastResult() != null) {
status="Upload failed: " + uploadObject.getLastResult().getLogMessage();
}
 else {
status="Upload failed.";
}
break;
case UPLOAD_FAILED_RETRY:
if (uploadObject.getLastResult() != null) {
status="Last failure: " + uploadObject.getLastResult().getLogMessage();
}
 else {
status="Upload will be retried shortly.";
}
String laterReason=FileUploadService.getUploadLaterReason(mParentActivity,uploadObject);
if (laterReason != null) {
status+="\n" + laterReason;
}
break;
case UPLOAD_LATER:
status=FileUploadService.getUploadLaterReason(mParentActivity,uploadObject);
break;
case UPLOAD_SUCCEEDED:
status="Completed.";
break;
case UPLOAD_CANCELLED:
status="Upload cancelled.";
break;
case UPLOAD_PAUSED:
status="Upload paused.";
break;
default :
status=uploadObject.getUploadStatus().toString();
if (uploadObject.getLastResult() != null) {
uploadObject.getLastResult().getLogMessage();
}
break;
}
if (uploadObject.getUploadStatus() != UploadStatus.UPLOAD_IN_PROGRESS) {
ProgressBar progressBar=(ProgressBar)view.findViewById(R.id.upload_progress_bar);
progressBar.setVisibility(View.GONE);
if (mParentActivity.getFileUploaderBinder() != null && mProgressListener != null && mCurrentUpload != null) {
OCFile currentOcFile=mCurrentUpload.getFile();
mParentActivity.getFileUploaderBinder().removeDatatransferProgressListener(mProgressListener,uploadObject.getAccount(mParentActivity),currentOcFile);
mProgressListener=null;
mCurrentUpload=null;
}
}
statusView.setText(status);
ImageButton rightButton=(ImageButton)view.findViewById(R.id.upload_right_button);
if (uploadObject.userCanRetryUpload() && uploadObject.getUploadStatus() != UploadStatus.UPLOAD_SUCCEEDED) {
rightButton.setImageDrawable(mParentActivity.getDrawable(R.drawable.ic_action_refresh_grey));
rightButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View v){
mParentActivity.getFileOperationsHelper().retryUpload(uploadObject);
}
}
);
}
 else if (uploadObject.userCanCancelUpload()) {
rightButton.setImageDrawable(mParentActivity.getDrawable(R.drawable.ic_cancel));
rightButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View v){
mParentActivity.getFileOperationsHelper().cancelTransference(uploadObject.getOCFile());
}
}
);
}
 else {
rightButton.setImageDrawable(mParentActivity.getDrawable(R.drawable.ic_delete));
rightButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View v){
mParentActivity.getFileOperationsHelper().removeUploadFromList(uploadObject);
}
}
);
}
ImageView fileIcon=(ImageView)view.findViewById(R.id.imageView1);
fileIcon.setImageResource(R.drawable.file);
try {
Bitmap b=ThumbnailsCacheManager.getBitmapFromDiskCache(uploadObject.getOCFile().getRemoteId());
if (b != null) {
fileIcon.setImageBitmap(b);
}
}
 catch (NullPointerException e) {
}
TextView uploadDate=(TextView)view.findViewById(R.id.upload_date);
CharSequence dateString=DisplayUtils.getRelativeDateTimeString(mParentActivity,uploadObject.getUploadTime().getTimeInMillis(),DateUtils.SECOND_IN_MILLIS,DateUtils.WEEK_IN_MILLIS,0);
uploadDate.setText(dateString);
}
return view;
}
