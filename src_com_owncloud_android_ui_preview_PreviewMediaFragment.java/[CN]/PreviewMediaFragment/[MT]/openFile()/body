{
  OCFile file=getFile();
  stopPreview(true);
  String storagePath=file.getStoragePath();
  String encodedStoragePath=WebdavUtils.encodePath(storagePath);
  try {
    Intent i=new Intent(Intent.ACTION_VIEW);
    i.setDataAndType(Uri.parse("file://" + encodedStoragePath),file.getMimetype());
    i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
    startActivity(i);
  }
 catch (  Throwable t) {
    Log_OC.e(TAG,"Fail when trying to open with the mimeType provided from the ownCloud server: " + file.getMimetype());
    boolean toastIt=true;
    String mimeType="";
    try {
      Intent i=new Intent(Intent.ACTION_VIEW);
      mimeType=MimeTypeMap.getSingleton().getMimeTypeFromExtension(storagePath.substring(storagePath.lastIndexOf('.') + 1));
      if (mimeType == null || !mimeType.equals(file.getMimetype())) {
        if (mimeType != null) {
          i.setDataAndType(Uri.parse("file://" + encodedStoragePath),mimeType);
        }
 else {
          i.setDataAndType(Uri.parse("file://" + encodedStoragePath),"*-/*");
        }
        i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
        startActivity(i);
        toastIt=false;
      }
    }
 catch (    IndexOutOfBoundsException e) {
      Log_OC.e(TAG,"Trying to find out MIME type of a file without extension: " + storagePath);
    }
catch (    ActivityNotFoundException e) {
      Log_OC.e(TAG,"No activity found to handle: " + storagePath + " with MIME type "+ mimeType+ " obtained from extension");
    }
catch (    Throwable th) {
      Log_OC.e(TAG,"Unexpected problem when opening: " + storagePath,th);
    }
 finally {
      if (toastIt) {
        Toast.makeText(getSherlockActivity(),"There is no application to handle file " + file.getFileName(),Toast.LENGTH_SHORT).show();
      }
    }
  }
  finish();
}
