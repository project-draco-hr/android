{
  Log.d(getClass().toString(),"onCreate() start");
  super.onCreate(savedInstanceState);
  Thread.setDefaultUncaughtExceptionHandler(new CrashHandler(getApplicationContext()));
  if (savedInstanceState != null) {
    mCurrentDir=savedInstanceState.getParcelable(FileDetailFragment.EXTRA_FILE);
  }
  if (!AccountUtils.accountsAreSetup(this)) {
    mStorageManager=null;
    createFirstAccount();
  }
 else {
    initDataFromCurrentAccount();
  }
  if (getIntent().getAction() != null && getIntent().getAction().equals(Intent.ACTION_MAIN) && savedInstanceState == null) {
    requestPinCode();
  }
  requestWindowFeature(Window.FEATURE_INDETERMINATE_PROGRESS);
  mDirectories=new CustomArrayAdapter<String>(this,R.layout.sherlock_spinner_dropdown_item);
  OCFile currFile=mCurrentDir;
  while (currFile != null && currFile.getFileName() != OCFile.PATH_SEPARATOR) {
    mDirectories.add(currFile.getFileName());
    currFile=mStorageManager.getFileById(currFile.getParentId());
  }
  mDirectories.add(OCFile.PATH_SEPARATOR);
  setContentView(R.layout.files);
  mFileList=(OCFileListFragment)getSupportFragmentManager().findFragmentById(R.id.fileList);
  mDualPane=(findViewById(R.id.file_details_container) != null);
  if (mDualPane && getSupportFragmentManager().findFragmentByTag(FileDetailFragment.FTAG) == null) {
    FragmentTransaction transaction=getSupportFragmentManager().beginTransaction();
    transaction.replace(R.id.file_details_container,new FileDetailFragment(null,null));
    transaction.commit();
  }
  ActionBar actionBar=getSupportActionBar();
  actionBar.setHomeButtonEnabled(true);
  actionBar.setDisplayHomeAsUpEnabled(mCurrentDir != null && mCurrentDir.getParentId() != 0);
  actionBar.setDisplayShowTitleEnabled(false);
  actionBar.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);
  actionBar.setListNavigationCallbacks(mDirectories,this);
  setSupportProgressBarIndeterminateVisibility(false);
  Log.d(getClass().toString(),"onCreate() end");
}
