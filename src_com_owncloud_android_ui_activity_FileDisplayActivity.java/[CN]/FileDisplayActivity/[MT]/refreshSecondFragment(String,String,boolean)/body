{
  FileFragment secondFragment=getSecondFragment();
  boolean waitedPreview=(mWaitingToPreview != null && mWaitingToPreview.getRemotePath().equals(downloadedRemotePath));
  if (secondFragment != null && secondFragment instanceof FileDetailFragment) {
    FileDetailFragment detailsFragment=(FileDetailFragment)secondFragment;
    OCFile fileInFragment=detailsFragment.getFile();
    if (fileInFragment != null && !downloadedRemotePath.equals(fileInFragment.getRemotePath())) {
      mWaitingToPreview=null;
    }
 else     if (downloadEvent.equals(FileDownloader.getDownloadAddedMessage())) {
      detailsFragment.listenForTransferProgress();
      detailsFragment.updateFileDetails(true,false);
    }
 else     if (downloadEvent.equals(FileDownloader.getDownloadFinishMessage())) {
      boolean detailsFragmentChanged=false;
      if (waitedPreview) {
        if (success) {
          mWaitingToPreview=getStorageManager().getFileById(mWaitingToPreview.getFileId());
          if (PreviewMediaFragment.canBePreviewed(mWaitingToPreview)) {
            startMediaPreview(mWaitingToPreview,0,true);
            detailsFragmentChanged=true;
          }
 else {
            getFileOperationsHelper().openFile(mWaitingToPreview,this);
          }
        }
        mWaitingToPreview=null;
      }
      if (!detailsFragmentChanged) {
        detailsFragment.updateFileDetails(false,(success));
      }
    }
  }
}
