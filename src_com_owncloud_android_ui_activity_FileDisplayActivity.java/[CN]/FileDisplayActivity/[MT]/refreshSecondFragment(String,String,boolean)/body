{
  FileFragment secondFragment=getSecondFragment();
  if (secondFragment != null) {
    boolean waitedPreview=(mWaitingToPreview != null && mWaitingToPreview.getRemotePath().equals(downloadedRemotePath));
    if (secondFragment instanceof FileDetailFragment) {
      FileDetailFragment detailsFragment=(FileDetailFragment)secondFragment;
      OCFile fileInFragment=detailsFragment.getFile();
      if (fileInFragment != null && !downloadedRemotePath.equals(fileInFragment.getRemotePath())) {
        mWaitingToPreview=null;
      }
 else       if (downloadEvent.equals(FileDownloader.getDownloadAddedMessage())) {
        detailsFragment.listenForTransferProgress();
        detailsFragment.updateFileDetails(true,false);
      }
 else       if (downloadEvent.equals(FileDownloader.getDownloadFinishMessage())) {
        boolean detailsFragmentChanged=false;
        if (waitedPreview) {
          if (success) {
            mWaitingToPreview=getStorageManager().getFileById(mWaitingToPreview.getFileId());
            if (PreviewMediaFragment.canBePreviewed(mWaitingToPreview)) {
              startMediaPreview(mWaitingToPreview,0,true);
              detailsFragmentChanged=true;
            }
 else             if (PreviewTextFragment.canBePreviewed(mWaitingToPreview)) {
              startTextPreview(mWaitingToPreview);
              detailsFragmentChanged=true;
            }
 else {
              getFileOperationsHelper().openFile(mWaitingToPreview);
            }
          }
          mWaitingToPreview=null;
        }
        if (!detailsFragmentChanged) {
          detailsFragment.updateFileDetails(false,(success));
        }
      }
    }
 else     if (secondFragment instanceof PreviewTextFragment) {
      ((PreviewTextFragment)secondFragment).loadAndShowTextPreview();
    }
 else     if (secondFragment instanceof PreviewMediaFragment) {
      OCFile file=getStorageManager().getFileByPath(downloadedRemotePath);
      startMediaPreview(file,0,true);
    }
  }
}
