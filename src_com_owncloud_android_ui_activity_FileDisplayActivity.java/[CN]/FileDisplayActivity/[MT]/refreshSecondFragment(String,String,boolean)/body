{
  FileFragment secondFragment=getSecondFragment();
  if (secondFragment != null) {
    invalidateOptionsMenu();
    secondFragment.onDownloadEvent(downloadEvent,downloadedRemotePath,success);
    if (secondFragment instanceof FileDetailFragment) {
      FileDetailFragment detailsFragment=(FileDetailFragment)secondFragment;
      OCFile fileInFragment=detailsFragment.getFile();
      if (fileInFragment != null && !downloadedRemotePath.equals(fileInFragment.getRemotePath())) {
        mWaitingToPreview=null;
      }
 else       if (downloadEvent.equals(FileDownloader.getDownloadFinishMessage())) {
        boolean waitedPreview=(mWaitingToPreview != null && mWaitingToPreview.getRemotePath().equals(downloadedRemotePath));
        if (waitedPreview) {
          if (success) {
            mWaitingToPreview=getStorageManager().getFileById(mWaitingToPreview.getFileId());
            if (PreviewAudioFragment.canBePreviewed(mWaitingToPreview)) {
              startAudioPreview(mWaitingToPreview,0);
            }
 else             if (PreviewVideoFragment.canBePreviewed(mWaitingToPreview)) {
              startVideoPreview(mWaitingToPreview,0);
            }
 else             if (PreviewTextFragment.canBePreviewed(mWaitingToPreview)) {
              startTextPreview(mWaitingToPreview);
            }
 else {
              getFileOperationsHelper().openFile(mWaitingToPreview);
            }
          }
          mWaitingToPreview=null;
        }
      }
    }
  }
}
