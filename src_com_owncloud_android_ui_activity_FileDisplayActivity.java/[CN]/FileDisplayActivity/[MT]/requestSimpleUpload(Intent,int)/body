{
  String filepath=null;
  try {
    Uri selectedImageUri=data.getData();
    String filemanagerstring=selectedImageUri.getPath();
    String selectedImagePath=getPath(selectedImageUri);
    if (selectedImagePath != null)     filepath=selectedImagePath;
 else     filepath=filemanagerstring;
  }
 catch (  Exception e) {
    Log_OC.e(TAG,"Unexpected exception when trying to read the result of Intent.ACTION_GET_CONTENT",e);
    e.printStackTrace();
  }
 finally {
    if (filepath == null) {
      Log_OC.e(TAG,"Couldnt resolve path to file");
      Toast t=Toast.makeText(this,getString(R.string.filedisplay_unexpected_bad_get_content),Toast.LENGTH_LONG);
      t.show();
      return;
    }
  }
  Intent i=new Intent(this,FileUploader.class);
  i.putExtra(FileUploader.KEY_ACCOUNT,getAccount());
  String remotepath=new String();
  for (int j=mDirectories.getCount() - 2; j >= 0; --j) {
    remotepath+=OCFile.PATH_SEPARATOR + mDirectories.getItem(j);
  }
  if (!remotepath.endsWith(OCFile.PATH_SEPARATOR))   remotepath+=OCFile.PATH_SEPARATOR;
  if (filepath.startsWith("content://")) {
    Cursor cursor=MainApp.getAppContext().getContentResolver().query(Uri.parse(filepath),null,null,null,null,null);
    try {
      if (cursor != null && cursor.moveToFirst()) {
        String displayName=cursor.getString(cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME));
        Log.i(TAG,"Display Name: " + displayName);
        remotepath+=displayName;
      }
    }
  finally {
      cursor.close();
    }
  }
 else {
    remotepath+=new File(filepath).getName();
  }
  i.putExtra(FileUploader.KEY_LOCAL_FILE,filepath);
  i.putExtra(FileUploader.KEY_REMOTE_FILE,remotepath);
  i.putExtra(FileUploader.KEY_UPLOAD_TYPE,FileUploader.UPLOAD_SINGLE_FILE);
  if (resultCode == UploadFilesActivity.RESULT_OK_AND_MOVE)   i.putExtra(FileUploader.KEY_LOCAL_BEHAVIOUR,FileUploader.LOCAL_BEHAVIOUR_MOVE);
  startService(i);
}
