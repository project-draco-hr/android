{
  String filePath=null;
  String mimeType=null;
  Uri selectedFileUri=data.getData();
  try {
    mimeType=getContentResolver().getType(selectedFileUri);
    String fileManagerString=selectedFileUri.getPath();
    String selectedFilePath=UriUtils.getLocalPath(selectedFileUri,this);
    if (selectedFilePath != null)     filePath=selectedFilePath;
 else     filePath=fileManagerString;
  }
 catch (  Exception e) {
    Log_OC.e(TAG,"Unexpected exception when trying to read the result of " + "Intent.ACTION_GET_CONTENT",e);
  }
 finally {
    if (filePath == null) {
      Log_OC.e(TAG,"Couldn't resolve path to file");
      Toast t=Toast.makeText(this,getString(R.string.filedisplay_unexpected_bad_get_content),Toast.LENGTH_LONG);
      t.show();
      return;
    }
  }
  Intent i=new Intent(this,FileUploader.class);
  i.putExtra(FileUploader.KEY_ACCOUNT,getAccount());
  OCFile currentDir=getCurrentDir();
  String remotePath=(currentDir != null) ? currentDir.getRemotePath() : OCFile.ROOT_PATH;
  if (selectedFileUri.toString().startsWith(UriUtils.URI_CONTENT_SCHEME)) {
    Cursor cursor=getContentResolver().query(selectedFileUri,null,null,null,null);
    try {
      if (cursor != null && cursor.moveToFirst()) {
        String displayName=cursor.getString(cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME));
        Log_OC.v(TAG,"Display Name: " + displayName);
        displayName=displayName.replace(File.separatorChar,'_');
        displayName=displayName.replace(File.pathSeparatorChar,'_');
        remotePath+=displayName;
        int pos=displayName.lastIndexOf('.');
        if (pos < 0) {
          remotePath+=DisplayUtils.getFileExtension(filePath);
        }
        Uri[] uris=new Uri[]{selectedFileUri};
        String[] remotePaths=new String[]{remotePath};
        ;
        copyThenUpload(uris,remotePaths);
        cursor.close();
        return;
      }
    }
 catch (    Exception e) {
      Log_OC.e(TAG,"Error while trying to copy and upload a schema type content file ",e);
    }
  }
 else {
    remotePath+=new File(filePath).getName();
  }
  int behaviour=(resultCode == UploadFilesActivity.RESULT_OK_AND_MOVE) ? FileUploader.LOCAL_BEHAVIOUR_MOVE : FileUploader.LOCAL_BEHAVIOUR_COPY;
  FileUploader.UploadRequester requester=new FileUploader.UploadRequester();
  requester.uploadNewFile(this,getAccount(),filePath,remotePath,behaviour,mimeType,false,UploadFileOperation.CREATED_BY_USER);
}
