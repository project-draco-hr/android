{
  String filePath=null;
  String mimeType=null;
  Uri selectedImageUri=data.getData();
  try {
    mimeType=getContentResolver().getType(selectedImageUri);
    String fileManagerString=selectedImageUri.getPath();
    String selectedImagePath=UriUtils.getLocalPath(selectedImageUri,this);
    if (selectedImagePath != null)     filePath=selectedImagePath;
 else     filePath=fileManagerString;
  }
 catch (  Exception e) {
    Log_OC.e(TAG,"Unexpected exception when trying to read the result of " + "Intent.ACTION_GET_CONTENT",e);
  }
 finally {
    if (filePath == null) {
      Log_OC.e(TAG,"Couldn't resolve path to file");
      Toast t=Toast.makeText(this,getString(R.string.filedisplay_unexpected_bad_get_content),Toast.LENGTH_LONG);
      t.show();
      return;
    }
  }
  Intent i=new Intent(this,FileUploadService.class);
  i.putExtra(FileUploadService.KEY_ACCOUNT,getAccount());
  OCFile currentDir=getCurrentDir();
  String remotePath=(currentDir != null) ? currentDir.getRemotePath() : OCFile.ROOT_PATH;
  if (filePath.startsWith(UriUtils.URI_CONTENT_SCHEME)) {
    Cursor cursor=getContentResolver().query(Uri.parse(filePath),null,null,null,null);
    try {
      if (cursor != null && cursor.moveToFirst()) {
        String displayName=cursor.getString(cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME));
        Log_OC.v(TAG,"Display Name: " + displayName);
        displayName.replace(File.separatorChar,'_');
        displayName.replace(File.pathSeparatorChar,'_');
        remotePath+=displayName + DisplayUtils.getComposedFileExtension(filePath);
      }
    }
  finally {
      cursor.close();
    }
  }
 else {
    remotePath+=new File(filePath).getName();
  }
  i.putExtra(FileUploadService.KEY_LOCAL_FILE,filePath);
  i.putExtra(FileUploadService.KEY_REMOTE_FILE,remotePath);
  i.putExtra(FileUploadService.KEY_MIME_TYPE,mimeType);
  i.putExtra(FileUploadService.KEY_UPLOAD_TYPE,FileUploadService.UPLOAD_SINGLE_FILE);
  if (resultCode == UploadFilesActivity.RESULT_OK_AND_MOVE) {
    i.putExtra(FileUploadService.KEY_LOCAL_BEHAVIOUR,FileUploadService.LOCAL_BEHAVIOUR_MOVE);
  }
  if (startService(i) == null) {
    Log_OC.e(TAG,"FileUploadService could not be started");
  }
}
