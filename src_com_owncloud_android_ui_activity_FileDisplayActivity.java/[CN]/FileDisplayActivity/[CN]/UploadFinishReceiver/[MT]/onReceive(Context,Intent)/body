{
  try {
    String uploadedRemotePath=intent.getStringExtra(FileUploadService.EXTRA_REMOTE_PATH);
    String accountName=intent.getStringExtra(FileUploadService.ACCOUNT_NAME);
    boolean sameAccount=getAccount() != null && accountName.equals(getAccount().name);
    OCFile currentDir=getCurrentDir();
    boolean isDescendant=(currentDir != null) && (uploadedRemotePath != null) && (uploadedRemotePath.startsWith(currentDir.getRemotePath()));
    if (sameAccount && isDescendant) {
      String linkedToRemotePath=intent.getStringExtra(FileUploadService.EXTRA_LINKED_TO_PATH);
      if (linkedToRemotePath == null || isAscendant(linkedToRemotePath)) {
        refreshListOfFilesFragment();
      }
    }
    boolean uploadWasFine=intent.getBooleanExtra(FileUploadService.EXTRA_UPLOAD_RESULT,false);
    boolean renamedInUpload=getFile().getRemotePath().equals(intent.getStringExtra(FileUploadService.EXTRA_OLD_REMOTE_PATH));
    boolean sameFile=getFile().getRemotePath().equals(uploadedRemotePath) || renamedInUpload;
    FileFragment details=getSecondFragment();
    boolean detailFragmentIsShown=(details != null && details instanceof FileDetailFragment);
    if (sameAccount && sameFile && detailFragmentIsShown) {
      if (uploadWasFine) {
        setFile(getStorageManager().getFileByPath(uploadedRemotePath));
      }
 else {
      }
      if (renamedInUpload) {
        String newName=(new File(uploadedRemotePath)).getName();
        Toast msg=Toast.makeText(context,String.format(getString(R.string.filedetails_renamed_in_upload_msg),newName),Toast.LENGTH_LONG);
        msg.show();
      }
      if (uploadWasFine || getFile().fileExists()) {
        ((FileDetailFragment)details).updateFileDetails(false,true);
      }
 else {
        cleanSecondFragment();
      }
      if (uploadWasFine) {
        OCFile ocFile=getFile();
        if (PreviewImageFragment.canBePreviewed(ocFile))         startImagePreview(getFile());
 else         if (PreviewTextFragment.canBePreviewed(ocFile))         startTextPreview(ocFile);
      }
    }
    mProgressBar.setIndeterminate(false);
  }
  finally {
    if (intent != null) {
      removeStickyBroadcast(intent);
    }
  }
}
