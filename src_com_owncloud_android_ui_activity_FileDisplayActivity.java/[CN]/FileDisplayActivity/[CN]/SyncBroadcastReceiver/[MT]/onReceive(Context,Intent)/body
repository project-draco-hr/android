{
  try {
    String event=intent.getAction();
    Log_OC.d(TAG,"Received broadcast " + event);
    String accountName=intent.getStringExtra(FileSyncAdapter.EXTRA_ACCOUNT_NAME);
    String synchFolderRemotePath=intent.getStringExtra(FileSyncAdapter.EXTRA_FOLDER_PATH);
    RemoteOperationResult synchResult=(RemoteOperationResult)intent.getSerializableExtra(FileSyncAdapter.EXTRA_RESULT);
    boolean sameAccount=(getAccount() != null && accountName.equals(getAccount().name) && getStorageManager() != null);
    if (sameAccount) {
      if (FileSyncAdapter.EVENT_FULL_SYNC_START.equals(event)) {
        mSyncInProgress=true;
      }
 else {
        OCFile currentFile=(getFile() == null) ? null : getStorageManager().getFileByPath(getFile().getRemotePath());
        OCFile currentDir=(getCurrentDir() == null) ? null : getStorageManager().getFileByPath(getCurrentDir().getRemotePath());
        if (currentDir == null) {
          Toast.makeText(FileDisplayActivity.this,String.format(getString(R.string.sync_current_folder_was_removed),mDirectories.getItem(0)),Toast.LENGTH_LONG).show();
          browseToRoot();
        }
 else {
          if (currentFile == null && !getFile().isFolder()) {
            cleanSecondFragment();
            currentFile=currentDir;
          }
          if (synchFolderRemotePath != null && currentDir.getRemotePath().equals(synchFolderRemotePath)) {
            OCFileListFragment fileListFragment=getListOfFilesFragment();
            if (fileListFragment != null) {
              fileListFragment.listDirectory(currentDir);
            }
          }
          setFile(currentFile);
        }
        mSyncInProgress=(!FileSyncAdapter.EVENT_FULL_SYNC_END.equals(event) && !SynchronizeFolderOperation.EVENT_SINGLE_FOLDER_SHARES_SYNCED.equals(event));
        if (SynchronizeFolderOperation.EVENT_SINGLE_FOLDER_CONTENTS_SYNCED.equals(event) && synchResult != null && !synchResult.isSuccess() && (synchResult.getCode() == ResultCode.UNAUTHORIZED || synchResult.isIdPRedirection() || (synchResult.isException() && synchResult.getException() instanceof AuthenticatorException))) {
          OwnCloudClient client=OwnCloudClientMap.removeClientFor(getAccount());
          if (client != null) {
            Credentials cred=client.getCredentials();
            String ssoSessionCookie=client.getSsoSessionCookie();
            if (cred != null || ssoSessionCookie != null) {
              boolean bearerAuthorization=(cred != null && cred instanceof BearerCredentials);
              boolean samlBasedSsoAuthorization=(cred == null && ssoSessionCookie != null);
              AccountManager am=AccountManager.get(context);
              if (bearerAuthorization) {
                am.invalidateAuthToken(getAccount().type,((BearerCredentials)cred).getAccessToken());
              }
 else               if (samlBasedSsoAuthorization) {
                am.invalidateAuthToken(getAccount().type,ssoSessionCookie);
              }
 else {
                am.clearPassword(getAccount());
              }
            }
          }
          requestCredentialsUpdate();
        }
      }
      removeStickyBroadcast(intent);
      Log_OC.d(TAG,"Setting progress visibility to " + mSyncInProgress);
      setSupportProgressBarIndeterminateVisibility(mSyncInProgress);
    }
    if (synchResult != null) {
      if (synchResult.getCode().equals(RemoteOperationResult.ResultCode.SSL_RECOVERABLE_PEER_UNVERIFIED)) {
        mLastSslUntrustedServerResult=synchResult;
      }
    }
  }
 catch (  RuntimeException e) {
    removeStickyBroadcast(intent);
  }
}
