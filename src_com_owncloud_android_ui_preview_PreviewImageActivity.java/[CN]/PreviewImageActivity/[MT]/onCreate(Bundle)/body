{
  super.onCreate(savedInstanceState);
  mFile=getIntent().getParcelableExtra(FileDetailFragment.EXTRA_FILE);
  mAccount=getIntent().getParcelableExtra(FileDetailFragment.EXTRA_ACCOUNT);
  if (mFile == null) {
    throw new IllegalStateException("Instanced with a NULL OCFile");
  }
  if (mAccount == null) {
    throw new IllegalStateException("Instanced with a NULL ownCloud Account");
  }
  if (!mFile.isImage()) {
    throw new IllegalArgumentException("Non-image file passed as argument");
  }
  setContentView(R.layout.preview_image_activity);
  ActionBar actionBar=getSupportActionBar();
  actionBar.setDisplayHomeAsUpEnabled(true);
  actionBar.setTitle(mFile.getFileName());
  mStorageManager=new FileDataStorageManager(mAccount,getContentResolver());
  mParentFolder=mStorageManager.getFileById(mFile.getParentId());
  if (mParentFolder == null) {
    mParentFolder=mStorageManager.getFileByPath(OCFile.PATH_SEPARATOR);
  }
  createViewPager();
  if (savedInstanceState == null) {
    mWaitingToPreview=(mFile.isDown()) ? null : mFile;
  }
 else {
    mWaitingToPreview=(OCFile)savedInstanceState.getParcelable(KEY_WAITING_TO_PREVIEW);
  }
  mDownloadConnection=new PreviewImageServiceConnection();
  bindService(new Intent(this,FileDownloader.class),mDownloadConnection,Context.BIND_AUTO_CREATE);
  mUploadConnection=new PreviewImageServiceConnection();
  bindService(new Intent(this,FileUploader.class),mUploadConnection,Context.BIND_AUTO_CREATE);
}
