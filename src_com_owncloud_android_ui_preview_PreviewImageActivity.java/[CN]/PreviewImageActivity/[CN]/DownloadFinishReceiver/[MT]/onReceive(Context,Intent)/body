{
  String accountName=intent.getStringExtra(FileDownloader.ACCOUNT_NAME);
  String downloadedRemotePath=intent.getStringExtra(FileDownloader.EXTRA_REMOTE_PATH);
  if (getAccount().name.equals(accountName) && downloadedRemotePath != null) {
    OCFile file=getStorageManager().getFileByPath(downloadedRemotePath);
    int position=mPreviewImagePagerAdapter.getFilePosition(file);
    boolean downloadWasFine=intent.getBooleanExtra(FileDownloader.EXTRA_DOWNLOAD_RESULT,false);
    if (downloadWasFine) {
      MediaScannerConnection.scanFile(context,new String[]{file.getStoragePath()},null,null);
    }
    if (position >= 0 && intent.getAction().equals(FileDownloader.getDownloadFinishMessage())) {
      if (downloadWasFine) {
        mPreviewImagePagerAdapter.updateFile(position,file);
      }
 else {
        mPreviewImagePagerAdapter.updateWithDownloadError(position);
      }
      mPreviewImagePagerAdapter.notifyDataSetChanged();
    }
 else {
      Log_OC.d(TAG,"Download finished, but the fragment is offscreen");
    }
  }
  removeStickyBroadcast(intent);
}
