{
  Bitmap result=null;
  if (params.length != 1)   return result;
  String storagePath=params[0];
  try {
    BitmapFactory.Options options=new Options();
    options.inScaled=true;
    options.inPurgeable=true;
    if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.GINGERBREAD_MR1) {
      options.inPreferQualityOverSpeed=false;
    }
    if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.HONEYCOMB) {
      options.inMutable=false;
    }
    options.inJustDecodeBounds=true;
    BitmapFactory.decodeFile(storagePath,options);
    int width=options.outWidth;
    int height=options.outHeight;
    int scale=1;
    Display display=getActivity().getWindowManager().getDefaultDisplay();
    Point size=new Point();
    int screenWidth;
    int screenHeight;
    if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.HONEYCOMB_MR2) {
      display.getSize(size);
      screenWidth=size.x;
      screenHeight=size.y;
    }
 else {
      screenWidth=display.getWidth();
      screenHeight=display.getHeight();
    }
    if (width > screenWidth) {
      scale=(int)Math.ceil((float)width / screenWidth);
      options.inSampleSize=scale;
    }
    if (height > screenHeight) {
      scale=Math.max(scale,(int)Math.ceil((float)height / screenHeight));
    }
    options.inJustDecodeBounds=false;
    result=BitmapFactory.decodeFile(storagePath,options);
  }
 catch (  Throwable t) {
    result=null;
    mThrowable=t;
    Log.e(TAG,"Unexpected error while creating image preview " + storagePath,t);
  }
  return result;
}
