{
  List<Uri> contentUris=new ArrayList<>();
  List<String> contentRemotePaths=new ArrayList<>();
  for (  Parcelable sourceStream : mStreamsToUpload) {
    Uri sourceUri=(Uri)sourceStream;
    if (sourceUri == null) {
      showDialog(DIALOG_NO_STREAM);
    }
 else {
      String displayName=UriUtils.getDisplayNameForUri(sourceUri,this);
      if (displayName == null) {
        showDialog(DIALOG_NO_STREAM);
      }
 else {
        String remotePath=mUploadPath + displayName;
        if (ContentResolver.SCHEME_CONTENT.equals(sourceUri.getScheme())) {
          contentUris.add(sourceUri);
          contentRemotePaths.add(remotePath);
        }
 else         if (ContentResolver.SCHEME_FILE.equals(sourceUri.getScheme())) {
          requestUpload(sourceUri.getPath(),remotePath);
        }
 else {
          showDialog(DIALOG_STREAM_UNKNOWN);
        }
      }
    }
  }
  if (!contentUris.isEmpty()) {
    copyThenUpload(contentUris.toArray(new Uri[contentUris.size()]),contentRemotePaths.toArray(new String[contentRemotePaths.size()]));
  }
  SharedPreferences.Editor appPrefs=PreferenceManager.getDefaultSharedPreferences(getApplicationContext()).edit();
  appPrefs.putString("last_upload_path",mUploadPath);
  appPrefs.apply();
}
