{
  try {
    for (    Parcelable mStream : mStreamsToUpload) {
      Uri uri=(Uri)mStream;
      String[] columnValues;
      String displayName;
      String filePath="";
      if (uri != null) {
        if (uri.getScheme().equals("content")) {
          String mimeType=getContentResolver().getType(uri);
          if (mimeType.contains("image")) {
            columnValues=getColumnsValues(uri,Images.Media.DISPLAY_NAME);
          }
 else           if (mimeType.contains("video")) {
            columnValues=getColumnsValues(uri,Images.Media.DISPLAY_NAME);
          }
 else           if (mimeType.contains("audio")) {
            columnValues=getColumnsValues(uri,Images.Media.DISPLAY_NAME);
          }
 else {
            columnValues=getColumnsValues(uri,Images.Media.DISPLAY_NAME);
          }
          displayName=(columnValues != null) ? columnValues[0] : uri.getLastPathSegment().replaceAll("\\s","") + "." + MimeTypeMap.getSingleton().getExtensionFromMimeType(mimeType);
        }
 else         if (uri.getScheme().equals("file")) {
          filePath=Uri.decode(uri.toString()).replace(uri.getScheme() + "://","");
          if (filePath.contains("mnt")) {
            String splitedFilePath[]=filePath.split("/mnt");
            filePath=splitedFilePath[1];
          }
          final File file=new File(filePath);
          displayName=file.getName();
        }
 else {
          throw new SecurityException();
        }
        filePath=mUploadPath + displayName;
        mRemoteCacheData.add(filePath);
        CopyTmpFileAsyncTask copyTask=new CopyTmpFileAsyncTask(this);
        Object[] params={uri,filePath,mRemoteCacheData.size() - 1,getAccount().name,getContentResolver()};
        mNumCacheFile++;
        showWaitingCopyDialog();
        copyTask.execute(params);
      }
 else {
        throw new SecurityException();
      }
      SharedPreferences.Editor appPrefs=PreferenceManager.getDefaultSharedPreferences(getApplicationContext()).edit();
      appPrefs.putString("last_upload_path",mUploadPath);
      appPrefs.apply();
      finish();
    }
  }
 catch (  SecurityException e) {
    String message=String.format(getString(R.string.uploader_error_forbidden_content),getString(R.string.app_name));
    Toast.makeText(this,message,Toast.LENGTH_LONG).show();
  }
}
