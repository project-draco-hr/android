{
  super.onCreate(savedInstanceState);
  mParents=new Stack<String>();
  ActionBar actionBar=getSupportActionBar();
  actionBar.setIcon(DisplayUtils.getSeasonalIconId());
  if (prepareStreamsToUpload()) {
    mAccountManager=(AccountManager)getSystemService(Context.ACCOUNT_SERVICE);
    Account[] accounts=mAccountManager.getAccountsByType(MainApp.getAccountType());
    if (accounts.length == 0) {
      Log_OC.i(TAG,"No ownCloud account is available");
      showDialog(DIALOG_NO_ACCOUNT);
    }
 else     if (accounts.length > 1) {
      Log_OC.i(TAG,"More then one ownCloud is available");
      showDialog(DIALOG_MULTIPLE_ACCOUNT);
    }
 else {
      mAccount=accounts[0];
      mStorageManager=new FileDataStorageManager(mAccount,getContentResolver());
      SharedPreferences appPreferences=PreferenceManager.getDefaultSharedPreferences(getApplicationContext());
      String last_path=appPreferences.getString("last_upload_path","");
      if (last_path.equals("/")) {
        mParents.add("");
      }
 else {
        String[] dir_names=last_path.split("/");
        for (        String dir : dir_names)         mParents.add(dir);
      }
      while (!mStorageManager.fileExists(generatePath(mParents))) {
        mParents.pop();
      }
    }
    populateDirectoryList();
  }
 else {
    showDialog(DIALOG_NO_STREAM);
  }
}
