{
  super.onCreate(savedInstanceState);
  if (savedInstanceState == null) {
    mParents=new Stack<String>();
  }
 else {
    mParents=(Stack<String>)savedInstanceState.getSerializable(KEY_PARENTS);
    mAccount=savedInstanceState.getParcelable(KEY_ACCOUNT);
    mFile=savedInstanceState.getParcelable(KEY_FILE);
    mStorageManager=new FileDataStorageManager(mAccount,getContentResolver());
    mAccountSelected=savedInstanceState.getBoolean(KEY_ACCOUNT_SELECTED);
  }
  ActionBar actionBar=getSupportActionBar();
  actionBar.setIcon(DisplayUtils.getSeasonalIconId());
  if (prepareStreamsToUpload()) {
    mAccountManager=(AccountManager)getSystemService(Context.ACCOUNT_SERVICE);
    Account[] accounts=mAccountManager.getAccountsByType(MainApp.getAccountType());
    if (accounts.length == 0) {
      Log_OC.i(TAG,"No ownCloud account is available");
      showDialog(DIALOG_NO_ACCOUNT);
    }
 else     if (accounts.length > 1 && !mAccountSelected) {
      Log_OC.i(TAG,"More than one ownCloud is available");
      showDialog(DIALOG_MULTIPLE_ACCOUNT);
    }
 else {
      if (savedInstanceState == null) {
        mAccount=accounts[0];
        mStorageManager=new FileDataStorageManager(mAccount,getContentResolver());
      }
      initTargetFolder();
      populateDirectoryList();
    }
  }
 else {
    showDialog(DIALOG_NO_STREAM);
  }
}
