{
  try {
    String event=intent.getAction();
    Log_OC.d(TAG,"Received broadcast " + event);
    String accountName=intent.getStringExtra(FileSyncAdapter.EXTRA_ACCOUNT_NAME);
    String synchFolderRemotePath=intent.getStringExtra(FileSyncAdapter.EXTRA_FOLDER_PATH);
    RemoteOperationResult synchResult=(RemoteOperationResult)intent.getSerializableExtra(FileSyncAdapter.EXTRA_RESULT);
    boolean sameAccount=(mAccount != null && accountName.equals(mAccount.name) && mStorageManager != null);
    if (sameAccount) {
      if (FileSyncAdapter.EVENT_FULL_SYNC_START.equals(event)) {
        mSyncInProgress=true;
      }
 else {
        OCFile currentFile=(mFile == null) ? null : mStorageManager.getFileByPath(mFile.getRemotePath());
        OCFile currentDir=(getCurrentFolder() == null) ? null : mStorageManager.getFileByPath(getCurrentFolder().getRemotePath());
        if (currentDir == null) {
          Toast.makeText(context,String.format(getString(R.string.sync_current_folder_was_removed),getCurrentFolder().getFileName()),Toast.LENGTH_LONG).show();
          browseToRoot();
        }
 else {
          if (currentFile == null && !mFile.isFolder()) {
            currentFile=currentDir;
          }
          if (synchFolderRemotePath != null && currentDir.getRemotePath().equals(synchFolderRemotePath)) {
            populateDirectoryList();
          }
          mFile=currentFile;
        }
        mSyncInProgress=(!FileSyncAdapter.EVENT_FULL_SYNC_END.equals(event) && !SynchronizeFolderOperation.EVENT_SINGLE_FOLDER_SHARES_SYNCED.equals(event));
        if (SynchronizeFolderOperation.EVENT_SINGLE_FOLDER_CONTENTS_SYNCED.equals(event) && synchResult != null && !synchResult.isSuccess() && (synchResult.getCode() == ResultCode.UNAUTHORIZED || synchResult.isIdPRedirection() || (synchResult.isException() && synchResult.getException() instanceof AuthenticatorException))) {
          OwnCloudClient client=null;
          try {
            OwnCloudAccount ocAccount=new OwnCloudAccount(mAccount,context);
            client=(OwnCloudClientManagerFactory.getDefaultSingleton().removeClientFor(ocAccount));
          }
 catch (          AccountNotFoundException e) {
            e.printStackTrace();
          }
catch (          AuthenticatorException e) {
            e.printStackTrace();
          }
catch (          OperationCanceledException e) {
            e.printStackTrace();
          }
catch (          IOException e) {
            e.printStackTrace();
          }
          if (client != null) {
            OwnCloudCredentials cred=client.getCredentials();
            if (cred != null) {
              AccountManager am=AccountManager.get(context);
              if (cred.authTokenExpires()) {
                am.invalidateAuthToken(mAccount.type,cred.getAuthToken());
              }
 else {
                am.clearPassword(mAccount);
              }
            }
          }
          requestCredentialsUpdate();
        }
      }
      removeStickyBroadcast(intent);
      Log_OC.d(TAG,"Setting progress visibility to " + mSyncInProgress);
      setSupportProgressBarIndeterminateVisibility(mSyncInProgress);
    }
  }
 catch (  RuntimeException e) {
    removeStickyBroadcast(intent);
  }
}
