{
  final int childCount=getChildCount();
  int largestChildHeight=0;
  for (int i=0; i < childCount; i++) {
    final View child=getChildAt(i);
    largestChildHeight=Math.max(child.getMeasuredHeight(),largestChildHeight);
  }
  int totalHeight=0;
  for (int i=0; i < childCount; i++) {
    final View child=getChildAt(i);
    if (child == null || child.getVisibility() == View.GONE) {
      continue;
    }
    final LinearLayout.LayoutParams lp=(LinearLayout.LayoutParams)child.getLayoutParams();
    float childExtra=lp.weight;
    if (childExtra > 0) {
      child.measure(MeasureSpec.makeMeasureSpec(child.getMeasuredWidth(),MeasureSpec.EXACTLY),MeasureSpec.makeMeasureSpec(largestChildHeight,MeasureSpec.EXACTLY));
      totalHeight+=largestChildHeight;
    }
 else {
      totalHeight+=child.getMeasuredHeight();
    }
    totalHeight+=lp.leftMargin + lp.rightMargin;
  }
  totalHeight+=getPaddingLeft() + getPaddingRight();
  setMeasuredDimension(getMeasuredWidth(),totalHeight);
}
