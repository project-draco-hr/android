{
  Uri uri=Uri.parse(AccountUtils.constructFullURLForAccount(appContext,account));
  WebdavClient client=createOwnCloudClient(uri,appContext,true);
  AccountManager am=AccountManager.get(appContext);
  if (am.getUserData(account,AccountAuthenticator.KEY_SUPPORTS_OAUTH2) != null) {
    AccountManagerFuture<Bundle> future=am.getAuthToken(account,AccountAuthenticator.AUTH_TOKEN_TYPE_ACCESS_TOKEN,null,currentActivity,null,null);
    Bundle result=future.getResult();
    String accessToken=result.getString(AccountManager.KEY_AUTHTOKEN);
    if (accessToken == null)     throw new AuthenticatorException("WTF!");
    client.setBearerCredentials(accessToken);
  }
 else   if (am.getUserData(account,AccountAuthenticator.KEY_SUPPORTS_SAML_WEB_SSO) != null) {
    AccountManagerFuture<Bundle> future=am.getAuthToken(account,AccountAuthenticator.AUTH_TOKEN_TYPE_SAML_WEB_SSO_SESSION_COOKIE,null,currentActivity,null,null);
    Bundle result=future.getResult();
    String accessToken=result.getString(AccountManager.KEY_AUTHTOKEN);
    if (accessToken == null)     throw new AuthenticatorException("WTF!");
    client.setSsoSessionCookie(accessToken);
  }
 else {
    String username=account.name.substring(0,account.name.lastIndexOf('@'));
    AccountManagerFuture<Bundle> future=am.getAuthToken(account,AccountAuthenticator.AUTH_TOKEN_TYPE_PASSWORD,null,currentActivity,null,null);
    Bundle result=future.getResult();
    String password=result.getString(AccountManager.KEY_AUTHTOKEN);
    client.setBasicCredentials(username,password);
  }
  return client;
}
