{
  ByteBuffer tmp=ByteBuffer.allocate(4096);
  int i=0;
  RandomAccessFile raf=new RandomAccessFile(mFile,"rw");
  FileChannel channel=raf.getChannel();
  FileLock lock=channel.tryLock();
  Iterator<OnDatatransferProgressListener> it=null;
  try {
    while ((i=channel.read(tmp)) >= 0) {
      out.write(tmp.array(),0,i);
      tmp.clear();
      it=mListeners.iterator();
      while (it.hasNext()) {
        it.next().onTransferProgress(i);
      }
    }
  }
 catch (  IOException io) {
    Log.e("FileRequestException",io.getMessage());
    throw new RuntimeException("Ugly solution to workaround the default policy of retries when the server falls while uploading ; temporal fix; really",io);
  }
 finally {
    lock.release();
    channel.close();
    raf.close();
  }
}
